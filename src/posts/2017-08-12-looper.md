<!--
{
  "title": "Looper",
  "date": "2017-08-12T13:01:30+09:00",
  "category": "",
  "tags": [],
  "draft": true
}
-->


# SooperLooper overview

TODO

- sync (quantize) implementation
- recording methods (record/overdub/substitute/replace)
- managing jack port
- gui/midi control
- session data file format (.slsess)
- new feature consideration
  - metronome for sync internal mode
  - fill empty record data so that user can start from dubmode with fixed length loop
      - create multiple of existing loop's length (applicable for sync internal mode and sync loop mode)
  - rewrite with qt
  - rewrite as lv2 plugin
  - should be able to delete loop not only last one

```
[ Data structure ]
Engine
'-* Looper
  '-'
'-* RingBuffer<LoopManageEvent> (adding/removing looper)
'-' ControlOSC ??
'-' EventGenerator
'-* RingBuffer<Event> (syncing etc..) (Event is a tuple of Command, Controle, ..)
'-* port_id_t _common_inputs, _common_outputs
'-' std::vector<sample_t *> _common_input_buffers, _common_output_buffers
'-' ..

JackAudioDriver < AudioDriver
'-' jack_client_t
'-* jack_port_t _input_ports, _output_ports

Gui stuff ??


[ Procedure ]

(Main thread)
- main =>
  - new JackAudioDriver
  - new Engine
  - Engine::initialize =>
    - JackAudioDriver::initialize =>
      - jack_set_process_callback(.. _process_callback ..)
    - JackAudioDriver::create_input_port("common_in_<N>") => jack_port_register
    - JackAudioDriver::create_output_port("common_out_<N>") => jack_port_register
    - new EventGenerator
    - new RingBuffer (for Event and some others)
    - calculate_tempo_frames
    - new ControlOSC =>
      - lo_server_new (from liblo)
      - register_callbacks => lo_server_add_method ..
      - init_osc_thread => pthread_create(.. _osc_receiver)
  - JackAudioDriver::activate => jack_activate
  - Engine::mainloop =>
    - while
      - TODO: add looper


(Process thread)
- JackAudioDriver::_process_callback => Engine::process =>
  - ??


(OSC thread)
- ControlOSC::osc_receiver => ??


(Gui process)
- IMPLEMENT_APP(SooperLooperGui::GuiApp) => .. =>
  - GuiApp::OnInit =>
    - new AppFrame =>
      - new LoopControl
    - AppFrame::Show
  - GuiApp::OnRun =>
    - LoopControl::connect =>
      - lo_address_new
      - spawn_looper => wxExecute("sooperlooper" ..)
    - wxApp::OnRun

(Gui process: UI event example)
-
```


# Reference

- [sooperlooper](http://essej.net/sooperlooper/)
