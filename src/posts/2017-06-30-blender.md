<!--
{
  "title": "Blender",
  "date": "2017-06-29T23:43:55+09:00",
  "category": "",
  "tags": [],
  "draft": true
}
-->

# TODO

- [x] build system, build artifacts
- UI system
- inspect data structure from python
  - https://docs.blender.org/api/2.78b/bpy.types.BlendData.html#bpy.types.BlendData
- blender file format
- cycle renderer
- thread management


# Build system

Build from source:

```
$ mkdir out/Default
$ cd out/Default
$ cmake -G Ninja -DPYTHON_VERSION=3.6 ../.. # set 3.6 since my arch doens't have 3.5
$ ninja -t browse # check build artifacts dependency for feeling overview
$ ninja -j2
$ BLENDER_SYSTEM_SCRIPTS=$PWD/../../release/scripts ./bin/blender # ModuleNotFoundError: No module named 'cycles' ??
```

File structure:

```
source/creator/ (main entrypoint)

source/blender/
  blenkernel/ (BKE)
  blenlib/    (BLI)
  modifiers/  (MOD)
  depsgraph/  (DAG)
  makesdna/, makesrna/ (Struct DNA)
  editors/    (?)
  nodes/      (?)
  python/     (?)
  ...

intern/
  cycles/ (? why is it not loaded)
  ...

extern/
  ...
```

# Overview

- file loading
- material and node editor
- object editor

```
[ Data structure ]
Global (aka G)
'-* Main
  '-' EvaluationContext
  '-' ...

bContext (aka C)
'-' wm
  '-' wmWindowManager
  '-' wmWindow
  '-' bScreen
'-' data
  '-' Main
  '-' py_context

SDNA
'-* name
'-* type
'-* struct

DEG::_depsnode_typeinfo_registry
'-* DepsNodeFactoryImpl<XXX> (e.g. IDDepsNode, ...)

Material (defmaterial)

(build time generation)
- makesrna/intern/RNA_blender_cpp.h (all structure used in blender ?)
- makesdna/intern/dna.c (DNAstr, file format ?)


[ Procedure ]
- main =>
  - CTX_create (alloc bContext)
  - DNA_sdna_current_init =>
    - g_sdna = DNA_sdna_from_data(DNAstr ..) =>
      - init_structDNA ..
  - BKE_blender_globals_init =>
    - G.main = BKE_main_new =>
      - alloc Main
      - DEG_evaluation_context_new => alloc EvaluationContext with DAG_EVAL_VIEWPORT
  - IMB_init =>
    - colormanagement_init => OCIO setup ..
  - BKE_modifier_init => modifier_type_init =>
    - INIT_TYPE(XXX) (e.g. Subsurf) => modifier_types[eModifierType_Subsurf] = &modifierType_Subsurf
  - DAG_init => DEG_register_node_types =>
    - DEG::_depsnode_typeinfo_registry = BLI_ghash_int_new
    - deg_register_base_depsnodes => DNTI_TIMESOURCE, DNTI_ID_REF
    - deg_register_component_depsnodes => ..
    - deg_register_operation_depsnodes => ..
  - main_args_setup, BLI_argsParse (arguments parsing)
  - RE_engines_init =>
    - BLI_addtail R_engines, &internal_render_type and internal_game_type
  - init_nodesystem =>
    - (TODO: what is "node" ? (for socket, compositor, texture, and shader ??))
    - reigister_xxx
    - registerCompositNodes => ..
    - registerShaderNodes =>
      - register_node_type_sh_xxx (e.g. bsdf_diffuse) => ?
    - registerTextureNodes => ..
  - init_def_material => BKE_material_init => intialize Material global (defmaterial)
  - WM_init =>
  - WM_keymap_init
  - WM_main =>
```

# Python interface

- bpy module
- execution environment
- text editor environment
- bpy.context

```
-
```


# Data structure

-
- user interaction
  - editor layout
  -
