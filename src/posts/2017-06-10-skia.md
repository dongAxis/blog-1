<!--
{
  "title": "Skia",
  "date": "2017-05-14T18:07:20+09:00",
  "category": "",
  "tags": ["graphics"],
  "draft": true
}
-->

# SampleApp

```
[ Data structure ]
SkOSWindow < SkWindow < SkView < SkEventSink
'-' SkUnixWindow (holding X stuff e.g. Display, GLXContext)
 - (as SkWindow)
  '-' SkSurfaceProps
  '-' SkBitmap
 - (as SkView)
  '-' draw

GMSampleView < SampleView < SkView
'-' AnalyticAntiAliasConvexGM < skiagm::GM

SkSurface_Base < SkSurface
- SkCanvas

(TODO: GL context (DRI setup?))
GrContext
GrGLContext
GrGLInterface
GrGpu
GrGLGpu


[ Main ]
- main =>
  - SkGraphics::Init =>
    - ... read_cpu_features and Init_sse4 for example
  - create_sk_window => new SampleWindow =>
    - SkWindow::SkWindow => a bunch of init ...
    - SkOSWindow::SkOSWindow =>
      - SkOSWindow::initWindow => X client routine
      - SkOSWindow::resize =>
        - SkBitmap::allocPixels
        - SkView::inval
        - SkView::setSize
    - SampleWindow::SampleWindow =>
      - SkGMRegistyToSampleRegistry =>
        - skiagm::GMRegistry::Head
          (loop through the list of kiagm::GM created via DEF_GM,
           e.g. DEF_GM( return new AnalyticAntiAliasConvexGM; ))
        - new SkViewRegister => new SkGMSampleViewFactory
      - fTypeface = SkTypeface::MakeFromName("Courier", ..)
      - keyboard shortcut setup (e.g. appendList(... "Raster", "OpenGL" ...)
      - SkView::setVisibleP, setClipToBounds
      - (*fSamples[fCurrIndex])() =>
        - SkGMSampleViewFactory::operator() =>
          - (initialize first skiagm::GM in this case new AnalyticAntiAliasConvexGM)
          - new GMSampleView
      - loadView =>
        - attachChildToFront
        - setSize
      - new DefaultDeviceManager
      - DefaultDeviceManager::setUpBackend =>
        - SkOSWindow::attach(kNativeGL_BackEndType, ..) => glx context setup
        - GrGLCreateNativeInterface
        - GrContext::Create => new GrContext, init =>
          - GrGpu::Create => GrGLGpu::Create =>
            - GrGLContext::Create => new GrGLContext
            - new GrGLGpu
          - initCommon =>
            - new GrDrawingManager, GrAtlasGlyphCache, GrTextBlobCache
        - windowSizeChanged => SkWindow::makeGpuBackedSurface =>
          - GrBackendRenderTarget
          - SkSurface::MakeFromBackendRenderTarget =>
            - GrContextPriv::MakeFromBackendRenderTargetRenderTargetContext =>
              - GrDrawingManager::makeRenderTargetContext => new GrRenderTargetContext
            - SkGpuDevice::Make => new SkGpuDevice
  - SkOSWindow::loop => for(;;)
    - nextXEvent => MyXNextEventWithDelay => XNextEvent
      - handleClick or handleKey ...
    - SkWindow::update =>
      - makeSurface => SkSurface::MakeRasterDirect
      - SkCanvas* canvas = SkSurface::getCanvas
      - SkCanvas::clipRegion(fDirtyRgn)
      - SampleWindow::draw(<SkCanvas>) =>
        - (kNo_Tiling == fTilingMode)
          - SkView::draw (as this->INHERITED::draw) =>
            - (as child->draw) SkView::draw => SampleView::onDraw =>
              - GMSampleView::onDrawContent => skiagm::GM::drawContent =>
                - AnalyticAntiAliasConvexGM::onDraw => ...
        - SkCanvas::flush =>
        - DefaultDeviceManager::publishCanvas =>
          - ...
          - SkOSWindow::present => glxSwapBuffers
    - doPaint =>
      - (for non glx case)
        - convertBitmapToXImage => XInitImage from SkBitmap
        - XPutImage
```


# Rendering

```
[ Shape rendering ]

[ Path rendering ]

[ Text rendering (Harfbuzz integration) ]

[ GL and shader usage ]
- GR_GL_CALL_RET =>
```


# Chromium (Blink)

- GPU process
  - platform GL backend ?
  - igalia's wayland backend fork ?
- Renderer (Blink)
  - SkPicture backend ?
  - impl thread paint


# Reference

- https://skia.org/user/tips
  - dumping .skp from chromium and load into debugger (skiaserve)
- http://behdad.org/text/


# TODO

- usage on android
- vulcan backend
