<!--
{
  "title": "Diary (2017-10-09 -- ?)",
  "date": "2017-10-09T11:02:08+09:00",
  "special": true
}
-->

# 2017-10-09

- Godot 2d rendering, nested viewport
  - why is there single frame delay rendering 3d viewport within 2d ?
      - by default VIEWPORT_UPDATE_WHEN_VISIBLE, which checks if RasterizerStorageGLES3::render_target_was_used,
        which in tern will be true only after RasterizerCanvasGLES3::\_bind_canvas_texture.

```
[ Data structure ]

Sprite < Node2D < CanvasItem
'-' ViewportTexture < Texture

Viewport < Node


[ Procedure ]

- .. = >CanvasItem::_enter_canvas => update =>
  - MessageQueue::push_call(.. "_update_callback")

- .. => CanvasItem::_update_callback =>
  - notification(NOTIFICATION_DRAW) .. =>
    - eg Sprite::_notification
      - Texture::draw_rect_region(RID p_canvas_item ..) =>
        - VisualServerCanvas::canvas_item_add_texture_rect_region =>
          - Item::commands.push_back(new Item::CommandRect) ..

- .. => VisualServerViewport::draw_viewports =>
  - RasterizerGLES3::set_current_render_target => storage->frame.current_rt = rt (for non system window target)
  - _draw_viewport =>
    - (for 3d) VisualServerScene::render_camera => ..
    - (for 2d) VisualServerCanvas::render_canvas =>
      - recursively _render_canvas_item and accumulate RasterizerCanvas::Item into z_list
      - RasterizerCanvasGLES3::canvas_render_items =>
        - loop by Item *p_item_list
          - CanvasShaderGLES3::set_conditional, custom_shader, bind ..
          - _canvas_item_render_commands =>
            - eg Item::CommandRect (ie TYPE_RECT)
              - _bind_canvas_texture => glBindTexture ..
              - glDrawArrays(GL_TRIANGLE_FAN, 0, 4) ((0, 0) -> (1, 0) -> (1, 1) -> (0, 1))


[ Godot Viewport to GL framebuffer ]

- new Viewport => VisualServerViewport::viewport_create => RasterizerStorageGLES3::render_target_create =>
  - new RenderTarget, new Texture (here we still didn't allocate GL resource yet)

- new SceneTree => .. => Viewport::set_size => RasterizerStorageGLES3::_render_target_allocate =>
  - glGenFramebuffers, glGenTextures (depth, color)
  - .. and much more things happening here ..


[ Godot canvas coordinate ]

- RasterizerCanvasGLES3::reset_canvas =>
  - Transform canvas_transform, translate(-w/2, -h/2, 0), scale(2/w, -2/h, 1)
```


- godot
  - instancing: particle, multimesh
  - nested viewport https://github.com/godotengine/godot/issues/11877
  - some rendering issues
      - https://github.com/godotengine/godot/issues/11710
      - https://github.com/godotengine/godot/issues/11670

- gl coordinates system again: https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glClipControl.xhtml

  > The default GL clip volume definition is for a origin of GL_LOWER_LEFT and a depth of GL_NEGATIVE_ONE_TO_ONE.


- gl texture structure (gl spec, section 8.5.3)

  > The first group is the lower left back corner of the texture image. Subsequent
  > groups fill out rows of width width from left to right; height rows are stacked from
  > bottom to top forming a single two-dimensional image slice; and depth slices are
  > stacked from back to front.

  - cf. https://www.w3.org/TR/PNG/


- unreal engine 4 build
  - https://aur.archlinux.org/packages/unreal-engine/
  - https://aur.archlinux.org/packages/unreal-tournament-4/ (how come it doesn't have dependency on engine ??)
  - https://aur.archlinux.org/packages/unrealtournament4/ (binary)


# 2017-10-10

- https://github.com/godotengine/godot/issues/11841
  - follow SpatialEditorViewport::\_menu_option(VIEW_ORTHOGONAL) and see difference from real camera orthogonal projection
  - SpatialEditorViewport::orthogonal
  - SpatialEditorViewport::\_update_camera on NOTIFICATION_PROCESS

- particle: halo, strand (hair, fur)
  - https://docs.blender.org/manual/en/dev/physics/particles/introduction.html
  - https://docs.blender.org/manual/en/dev/physics/particles/hair/introduction.html
  - particle consists of frames of position within its lifespan (it can let physics simulation to produce that)
  - strand (hair) is represented as its path
  - hair modeling and rendering setup: https://www.youtube.com/watch?v=JysKjqKk8kw
  - strand geometric parameter: thickness, shape etc .. (it's cycle rendering time information though)
  - strand rendering parameter: bsdf https://docs.blender.org/manual/en/dev/render/cycles/nodes/types/shaders/hair.html

- hair in real time
  - non particle based one. polygonal (or card)
  - how do you get volumetric taste ?? (just rendering both faces ??)
  - anisotropic specular (is this from Kajiya-Key ?)
  - normal, diffuse, depth from texture ?? (maybe baked occlusion too ??)
  - modeling polygonal hair
      - https://bartoszstyperek.wordpress.com/2017/07/29/hair-tool-blender-addon/
      - https://www.youtube.com/watch?v=TAE01dIpS1o
  - https://en.wikipedia.org/wiki/Hair
  - Marschner: http://graphics.stanford.edu/papers/hair/
  - SIGGRAPH course: http://blog.selfshadow.com/publications/s2016-shading-course/karis/s2016_pbs_epic_hair.pdf
  - Kajiya & Key: http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.127.5564
  - http://www.eugenedeon.com/project/an-energy-conserving-hair-reflectance-model/

- asset
  - https://www.textures.com/browse/substance/114546


# 2017-10-11

- godot particles
  - shader, rendering pipeline
  - do they contribute to shadow map ? yes, it can. Particles are just mesh with instancing within render_list.
  - particle behaviour calculation (particles.glsl with feedback executed in each frame)
  - mesh as emission points (unwrap position and normal from mesh as texture) (not real-time ready ?)

```
[ Data structure ]

Particles < GeometryInstance (in 3d scene)
'-' emitting, amount ..
'-' ParticlesMaterial < Material (process_material)
  '-' shader RID ..
'-* Mesh (draw_passes)

Particles < GeometryOwner (in RasterizerStorageGLES3)
'-' (almost same members are copied to GLES3 layer too eg emitting, amount ..)


[ Procedure ]

- new PrimitiveMesh => RasterizerStorageGLES3::mesh_create => new Mesh

- new Particles =>
  - RasterizerStorageGLES3::particles_create => new Particles =>
    - glGenBuffers(.. particle_buffers) glGenVertexArrays(.. particle_vaos)

- Particles::set_draw_pass_mesh =>
  -  PrimitiveMesh::get_rid => _update =>
    - VisualServer::mesh_add_surface_from_arrays =>
      - RasterizerStorageGLES3::mesh_add_surface =>
        - new Surface
        - glGenBuffers(1, &surface->vertex_id), index_id, array_id, instancing_array_id ..
    - RasterizerStorageGLES3::mesh_surface_set_material

- RasterizerStorageGLES3::particles_set_amount =>
  - glBindVertexArray(.. particle_vaos)
  - glBindBuffer(.. particle_buffers)
  - setup vertex attributes

- RasterizerStorageGLES3::update_dirty_resources =>
  - update_particles =>
    - glEnable(GL_RASTERIZER_DISCARD)
    - iterate over particle_update_list
      - ParticlesShaderGLES3::bind (glsl shader program setup)
      - RasterizerStorageGLES3::_particles_process =>
        - glBindVertexArray(.. particle_vaos[0])
        - glBindBufferBase(GL_TRANSFORM_FEEDBACK_BUFFER .. particle_buffers[1])
        - glBeginTransformFeedback(GL_POINTS)
        - glDrawArrays(GL_POINTS, 0, p_particles->amount)
            feedback color, velocity, custom, xform, which will be
            the input of scene.glsl with USE_INSTANCING
            particle_buffers[0] is for input vertex attribute and obtain feedback into particle_buffers[1]
            and at the same time the previous result is used as particle_buffers[0]
        - glEndTransformFeedback()

- RasterizerSceneGLES3::_render_list =>
  - _fill_render_list =>
    - case VS::INSTANCE_PARTICLES
      - _add_geometry => ..
  - _setup_geometry =>
    - case VS::INSTANCE_PARTICLES
      - glBindVertexArray(s->instancing_array_id)
      - glBindBuffer(GL_ARRAY_BUFFER, particles->particle_buffers[0])
  - _render_geometry =>
    - case VS::INSTANCE_PARTICLES
      - glDrawElementsInstanced(.. amount)


[ particles.glsl + ParticlesMaterial's godot shader generation ]

float restart_phase = float(gl_VertexID)/float(total_particles)
```

# 2017-10-12

- flip vertically
  - https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/gl_FragCoord.xhtml
  - texelFetch (integer pixel coordinates)
  - textureLod (texture uv coordinates)
  - see glsl spec

# 2017-10-13

- c++ construction/destruction semantics
  - http://en.cppreference.com/w/cpp/language/rule_of_three
  - http://en.cppreference.com/w/cpp/language/copy_constructor
  - http://en.cppreference.com/w/cpp/language/copy_assignment
  - http://en.cppreference.com/w/cpp/language/move_constructor
  - http://en.cppreference.com/w/cpp/language/return

# 2017-10-14

- gdb
  - lldb got some unexpected behaviour so I switch to gdb fow now
    (lldb couldn't add breakpoint at ResourceImporterWebm::import)
  - https://sourceware.org/gdb/current/onlinedocs/gdb/index.html
  - execute program (run <arguments>)
  - breakpoint (br <function name>)
  - next line (n), step in (s), step out (finish (fin)), continue (c)
  - stack frame (bt, up, down)
  - toggle ui (C-x C-a)
  - variables information (info args, info locals, ptype, whatis, print (p))
  - step out of loop (until +2 or something)
  - thread selection (info threads, thread <id>)

- godot asset import system

```
[ Data structure ]

EditorFileSystem (constantly probe file system)
ImportDock (reimporting with parameter)
ResourceImporterWebm < ResourceImporter
ResourceFormatSaverBinary < ResourceFormatLoader

PropertyEditor < Control
'-' CustomPropertyEditor < Popup
  '-' EditorFileDialog


[ Procedure ]

(off-thread file scanning)
- EditorNode::_notification(NOTIFICATION_WM_FOCUS_IN) =>
  - EditorFileSystem::scan_changes =>
    - Thread::create(_thread_func_sources ..) --->
      - _scan_fs_changes recursively and accumulate scan_actions

(importing routine on main thread)
- EditorFileSystem::_notification(NOTIFICATION_PROCESS) =>
  - EditorFileSystem::_update_scan_actions => reimport_files, _reimport_file =>
    - ResourceFormatImporter::get_importer_by_name, get_importer_by_extension (here I assume .webm)
    - ResourceImporterWebm::get_import_options ..
    - ResourceFormatImporter::get_import_base_path (returns "res://.import/<filename>-<md5>")
    - ResourceImporterWebm::import =>
      - new VideoStreamWebm
      - ResourceSaver::save(res://.import/<filename>-<md5>.webmstr" ..) =>
        - probe savers (eg ResourceFormatSaverBinary, ResourceFormatSaverText ..)
        - ResourceFormatSaverBinary::save => ResourceFormatSaverBinaryInstance::save =>
          - save Resource's property (eg VideoStreamWebm's file, Resource's resource_path ..)
    - then save "<filename>.import" with importer name and import options ..

(loading asset (eg from PropertyEditor))
- PropertyEditor::_custom_editor_request =>
  - CustomPropertyEditor::edit => .. (eg show "New VideoStreamWebm" based on property hint)
  - CustomPropertyEditor::popup => ..

- CustomPropertyEditor::connect("id_pressed", this, "_menu_option") -->
  - CustomPropertyEditor::_menu_option => .. EditorFileDialog::popup_centered_ratio

- EditorFileDialog::connect("file_selected", this, "_file_selected") -->
  - CustomPropertyEditor::_file_selected =>
    - ResourceLoader::load("res://xxx.webm" ..) => _load => ResourceFormatImporter::load =>
      - _get_path_and_type (read "<filename>.import")
      - ResourceLoader::_load("res://.import/xxx.webm-...") => ResourceFormatLoader::load =>
        - ResourceFormatLoaderBinary::load_interactive => ..
        - then you'll get VideoStreamWebm with file property "res://llamigos-small.webm" ..
    - emit_signal("variant_changed")

- CustomPropertyEditor::connect("variant_changed", this, "_custom_editor_edited") -->
  - PropertyEditor::_custom_editor_edited => _edit_set => Resource::set ..
```

- clang format for changed file within git
  - `clang-format -i -style=file $(git diff --name-only master | grep -P '(\.cpp$)|(\.h$)')`

- [ ] godot visual programming system
  - data path, control path, game loop coordination (out of box as Node notifications in GDScript)
  - http://docs.godotengine.org/en/latest/learning/scripting/visual_script/visual_script_basics.html
  - compare with unreal blueprint https://docs.unrealengine.com/latest/INT/Engine/Blueprints/index.html

- image based lighting
  - dual paraboloid radience map


# 2017-10-15

- volume rendering
  - https://en.wikipedia.org/wiki/Volume_rendering
  - https://en.wikipedia.org/wiki/Volume_ray_casting
  - https://en.wikipedia.org/wiki/Marching_cubes

- godot app export system
  - http://docs.godotengine.org/en/latest/learning/workflow/export/index.html
  - http://docs.godotengine.org/en/latest/development/compiling/compiling_for_x11.html#building-export-templates
  - for example `EditorExportPlatformPC::export_project` (as used for x11) copies godot executable as "<app-name>.bin"
    and creates "<app-name>.pck" next to it.
    Then, at runtime `Main::setup => Main::ProjectSettings::setup` will probe ".pck" based on executable name.
  - android: Godot engine as native shared library and activity as entrypoint
    `EditorExportAndroid::export_project` unzip template .apk and zip it with project resource and specified configuration
  - web browser: (??)

- shader experiment
  - multipass material (eg. toon brdf + black back face grow)
  - screen space (alpha) pass
      - RenderList::add_alpha_element vs add_element upon RasterizerSceneGLES3::\_add_geometry_with_material
      - RasterizerSceneGLES3::render_scene then has two parts of \_render_list for element and alpha_element
  - screen space refraction
  - flow map

- gl blend modes
  - spec 17.3.6 Blending (blend equation + blend weighting)


# 2017-10-16, 2017-10-17

- screen space effect
  - https://github.com/godotengine/godot-demo-projects/tree/master/2d/screen_space_shaders

- glTF
  - https://github.com/KhronosGroup/glTF
  - https://raw.githubusercontent.com/KhronosGroup/glTF/master/specification/2.0/figures/gltfOverview-2.0.0.png
  - https://github.com/KhronosGroup/glTF-Sample-Models
  - https://github.com/ksons/gltf-blender-importer
  - https://github.com/Kupoman/blendergltf
  - https://github.com/KhronosGroup/glTF-Blender-Exporter

- disolve shader

- skinning (in vertex shader)
  - see glTF overview
  - why inverse bind matrices ??

- morphing

- contact shadow
  - godot scene.glsl contact_shadow_compute

- animation
  - joints vs bones
  - https://docs.blender.org/manual/en/dev/rigging/armatures/introduction.html


# 2017-10-18

- Godot: animation, skelton, skinning, morphing (aka blend shape) (via glTF import)
  - glTF import animation merger script
  - Bones visualization
  - inverse bind matrix ??
  - name nodes and animations for easier debugging
  - last render skelton (set_on_top_of_alpha ??)

```
( Data structure )
ArrayMesh < Mesh
'-* Surface
  '-' Material
'-' RID mesh (ie ...)
  '-'

RasterizerStorageGLES3::Mesh < GeometryOwner < Instantiable < RID_Data
'-* Surface < Geometry
  '-* Attrib
  '-' array_id, vertex_id, index_id ..


( Mesh management )
- EditorSceneImporterGLTF::_parse_meshes =>
  - ArrayMesh::add_surface_from_arrays =>
    - VisualServer::mesh_add_surface_from_arrays =>
      - RasterizerStorageGLES3::mesh_add_surface ..

- EditorSceneImporterGLTF::_parse_skins =>
  - ??

( Rendering )
follow USE_SKELETON conditional in scene.glsl
- vertex deformed by up-to 4 bones (vec4)
- skeleton_texture holds bones' transformations
```


- Godot reimport bug

```
( example files )

- xxx.gltf
- xxx.gltf.import (remap path .import/xxx.gltf-md5.scn)
- .import/xxx.gltf-md5.scn
- yyy.tscn (instance ext_resource xxx.gltf)


( reimport routines )

- EditorFileSystem::reimport_files =>
  - ..
  - emit_signal("resources_reimported", p_files) -->
    - EditorNode::_resources_reimported("xxx.gltf") =>
      - 1. skip resource if it's not in ResourceCache (ie not used in editor yet)
      - 2. if it's PackedScene, reload_scene
      - 3. otherwise Resource::reload_from_file => ..

- EditorNode::reload_scene =>
  - "xxx.gltf" resource set_path("")
  - check if "xxx.gltf" is opened in any tabs
  - when "xxx.gltf" is not open in any tab, set_current_scene(current_tab) =>
    - here hoping the current tab scene will refresh if it's depending on "xxx.gltf"
    - EditorData.check_and_update_scene =>
      - _find_updated_instances => (this should catch)
      - PackedScene::pack, instance => ..
      - Node *new_scene, set_filename("yyy.tscn") ..
    - ..
```


# 2017-10-19

- rendering pipeline
  - shadow map         (depth_pass)
  - depth           (depth_pass)
  - scene non alpha
  - scene alpha     (alpha_pass)

- glDepthMask, glEnable(GL_DEPTH_TEST)
- alpha pre pass

- https://www.youtube.com/playlist?list=PL3wFcRXImVPOQpi-wi7uriXBkykXVUntv

- godot glTF import bug
  - reading JOINTS_0 might got wrong (of course, just reading indeces won't be wrong)
    so, there're might be something wrong in numbering joints.


# 2017-10-20

- morph
  - https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets
  - `RasterizerSceneGLES3::\_setup_geometry => RasterizerStorageGLES3::mesh_render_blend_shapes`
  - blend_shape.glsl with feedback`

- normal, tangent, bitangent
  - https://www.opengl.org/discussion_boards/showthread.php/173724-Tangent-or-object-space
  - http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-13-normal-mapping/

- Unreal engine architecture
  - build system: https://docs.unrealengine.com/latest/INT/Programming/UnrealBuildSystem/index.html
  - cf https://aur.archlinux.org/packages/unreal-engine/
  - cf MSBuild https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild
  - cf UnrealTournament (as example project)
  - project system (aka plugable module): https://docs.unrealengine.com/latest/INT/Engine/Basics/Projects/index.html
  - editor linking game program ?
  - editor viewport ticks ?

```
[ Build steps ]

Setup.sh (Engine/Build/BatchFiles/Linux/Setup.sh)
- Install buld dependencies from distribution's package manager (eg clang, mono ..)
- GitDependencies.sh (mono Engine/Binaries/DotNET/GitDependencies.exe)
  - GitDependencies.exe is prebuild and source is under Engine/Source/Programs/GitDependencies
  - Generate .ue4dependencies (not sure how exactly yet) and download listed files from http://cdn.unrealengine.com/dependencies
- BuildThirdParty.sh (build opus, zlib etc if wanted)

GenerateProjectFiles.sh (Engine/Build/BatchFiles/Linux/GenerateProjectFiles.sh)
- xbuild Source/Programs/UnrealBuildTool/UnrealBuildTool.csproj (build UnrealBuildTool itself)
- mono Binaries/DotNET/UnrealBuildTool.exe -makefile
  - Generate Makefile (follow UnrealBuildTool/System/MakefileGenerator.cs)
  - (UnrealBuildTool/System/TargetReceipt.cs, ModuleDescriptor.cs looks helpful)
  - Generate Engine/Intermidiate/Build/BuildRules/UE4RulesSourceFiles.txt (list XXX.Target.cs and XXX.Module.cs)
  - Generate Engine/Saved/UnrealBuildTool/BuildConfiguration.xml

Makefile
- mono Engine/Binaries/DotNET/UnrealBuildTool.exe UE4Editor Linux Development
  - How are XXX.Target.cs, XXX.Module.cs files executed ??


[ Source/Build tree (picking up some notable files) ]

(Editor tree)
- Engine/
  - Source/UE4Editor.Target.cs (: TargetRules)
  - Source/Runtime/
    - CoreUObject/
      - Public/UObject/ (Class.h, Object.h ..)
    - Engine/
      - Engine.Build.cs (: ModuleRules)
      - Classes/
        - Components/ (ActorComponent.h ..)
        - Engine/ (GameEngine.h, GameInstance.h ..)
        - GameFramework/ (Actor.h ..)
    - CinematicCamera/ (some randomly selected simple module example)
      - CinematicCamera.Build.cs (: ModuleRules)
      - Private/CinematicCameraModule.h, CineCameraComponent.h, ..
      - Public/CinematicCameraModule.cpp ..
  - Intermidiate/Build/XXX/UE4Editor/Development/
    - Engine/
      - Module.Engine.gen.x_of_y.cpp .. (mushing up translation units)
    - CinematicCamera/
      - Definitions.CinematicCamera.h
      - Module.CinematicCamera.cpp
      - Module.CinematicCamera.gen.cpp
    - libUE4Editor-Engine.so.response
    - libUE4Editor-CinematicCamera.so.response
    - ..
  - Binaries/Linux/
    - UE4Editor (executable)
    - libUE4Editor-Engine.so
    - libUE4Editor-CinematicCamera.so
    - ..

(Project tree)
- MyProject/
  - MyProject.uproject
  - Source/
    - MyProject.Target.cs, MyProjectEditor.Target.cs
    - MyProject/
      - MyProject.Build.cs
      - MyActor.h, cpp
      - ..
  - Intermidiat/Build/Linux/XXX/UE4Editor/Inc/MyProject/
    - MyActor.generated.h, MyActor.gen.cpp ..
  - Binaries/Linux/libUE4Editor-MyProject.so (how is this hot reloaded ??)
```


- Unreal engine architecture
  - c++ system
      - https://docs.unrealengine.com/latest/INT/Programming/UnrealArchitecture/index.html
      - https://docs.unrealengine.com/latest/INT/Programming/Introduction/index.html
      - Actor, Component, Object
  - what is "Game" ?
      - https://docs.unrealengine.com/latest/INT/Gameplay/Framework/GameFlow/index.html
      - https://docs.unrealengine.com/latest/INT/Gameplay/Framework/GameMode/index.html
  - graphics system: https://docs.unrealengine.com/latest/INT/Programming/Rendering/index.html


# 2017-10-21

- Unreal engine architecture
  - https://www.unrealengine.com/en-US/blog/unreal-property-system-reflection
  - https://docs.unrealengine.com/latest/INT/Programming/QuickStart/index.html
  - cscope setup `find Engine/Source/Runtime -name '*.h' -o -name '*.cpp' -print > cscope.files && cscope -qRbk`
  - yet another "main" follwoing until ticking loop
      - Game, Actor (Map), Player's pawn

```
- main, CommonLinuxMain, GuardedMain =>
  - EnginePreInit => FEngineLoop::PreInit =>
    - LoadPreInitModules ("Engine", "Renderer", ..)
    - AppInit =>
      - UGameUserSettings::PreloadResolutionSettings => .. => FLinuxPlatformMisc::PlatformInitMultimedia => SDL_Init ..
    - InitGamePhys => LoadPhysXModules ..
    - FLinuxPlatformSplash::Show => SDL_CreateWindow for splash and StartSplashScreenThread ..
    - RHIInit =>
      - PlatformCreateDynamicRHI => FOpenGLDynamicRHIModule::CreateRHI => new FOpenGLDynamicRHI =>
        - PlatformInitOpenGL => SDL_GL_XXX ..
        - PlatformCreateOpenGLDevice ..
    - FDefaultGameMoviePlayer::Initialize =>
      - FPlatformSplash::Hide
      - UGameEngine::CreateGameWindow =>
        - SNew(SWindow), SWindow::ShowWindow ..
    - StartRenderingThread =>
      - new FRenderingThread (--> RenderingThreadMain)
  - EngineInit => FEngineLoop::Init =>
    - NewObject (UGameEngine (or UUnrealEdEngine in editor mode) (from DefaultEngine.ini))
    - UGameEngine::Init =>
      - UEngine::Init => ..
      - UGameInstance::InitializeStandalone =>
        - UEngine::CreateNewWorldContext
        - UWorld::CreateWorld => NewObject<UWorld> ..
      - UGameViewportClient::Init => ..
      - CreateGameViewport =>
        - new FSceneViewport ..
        - UGameViewportClient::SetViewportFrame ..
    - UGameEngine::Start => UGameInstance::StartGameInstance =>
      - GetGameDefaultMap (from DefaultEngine.ini (eg /Game/ThirdPersonCPP/Maps/ThirdPersonExampleMap))
      - UEngine::Browse => LoadMap =>
        - (huge logic here eg cleaning up old world, travelling, networking, streaming .. ?)
        - LoadPackage(.. URL.Map ..)
        - UWorld::FindWorldInPackage => ..
        - UWorld::InitWorld => CreatePhysicsScene ..
        - UWorld::SetGameMode => CreateGameModeForURL =>
          - DefaultGameMode (from DefaultEngine.ini (eg /Script/MyProject.MyProjectGameMode))
          - UWorld::SpawnActor => .. => MyProjectGameMode::MyProjectGameMode (set DefaultPawnClass)
        - UWorld::InitializeActorsForPlay =>
          - UpdateWorldComponents =>
            - ULevel::UpdateLevelComponents, IncrementalUpdateComponents => AActor::IncrementalRegisterComponents ..
            - AGameModeBase::InitGame => ..
        - ULocalPlayer::SpawnPlayActor => UWorld::SpawnPlayActor => ..
        - UWorld::BeginPlay => ..
        - RedrawViewports => FViewport::Draw
  - loop EngineTick => FEngineLoop::Tick =>
    - ENQUEUE_UNIQUE_RENDER_COMMAND(BeginFrame ..)
    - UGameEngine::Tick =>
      - UWorld::Tick =>
        - RunTickGroup "PrePhysics" => .. => AActor::Tick
        - RunTickGroup (PostPhysics, PostUpdateWork etc ..)
    - ProcessLocalPlayerSlateOperations, FSlateApplication::Tick => ..
    - ENQUEUE_UNIQUE_RENDER_COMMAND(EndFrame ..)
```

- anti alias
    - https://en.wikipedia.org/wiki/Spatial_anti-aliasing
    - https://en.wikipedia.org/wiki/Supersampling
    - MSAA https://en.wikipedia.org/wiki/Multisample_anti-aliasing
    - temporal AA https://en.wikipedia.org/wiki/Temporal_anti-aliasing
    - [ ] skia (google's 2D drawing library) https://skia.org/dev/design/aaa
    - [ ] FXAA http://developer.download.nvidia.com/assets/gamedev/files/sdk/11/FXAA_WhitePaper.pdf


# 2017-10-22

- Unreal Engine architecture
  - https://docs.unrealengine.com/latest/INT/Programming/Tutorials/index.html
  - User input control (Possesion, APawn, AController)

```
(User input control (APlayerController, ACharacter, UCharacterMovementComponent, UInputComponent, UPlayerInput))

- UEngine::LoadMap =>
  - UWorld::InitializeActorsForPlay =>
    - .. => APawn::PreInitializeComponents => ULevel::RegisterActorForAutoReceiveInput ..
    - .. => AActor::IncrementalRegisterComponents => .. => UMovementComponent::OnRegister =>
      - AActor::GetRootComponent, UCharacterMovementComponent::SetUpdatedComponent
  - ULocalPlayer::SpawnPlayActor => UWorld::SpawnPlayActor =>
    - AGameModeBase::Login => SpawnPlayerController ..
    - APlayerController::SetPlayer => InitInputSystem =>
      - NewObject<UPlayerInput>
      - SetupInputComponent => NewObject<UInputComponent> (used only for APawn, not for ACharacter ?)
      - ULevel::PushPendingAutoReceiveInput => APlayerController::Possess =>
        - ACharacter::PossessedBy
        - APlayerController::SetPawn => AController::AddPawnTickDependency =>
          - ACharacter::GetMovementComponent (ie UCharacterMovementComponent)
          - FTickFunction::AddPrerequisite

- Prephysics Tick -->
  - APlayerController::TickActor => PlayerTick => TickPlayerInput =>
    - ProcessPlayerInput =>
      - BuildInputStack
      - UPlayerInput::ProcessInputStack =>
        - delegate action mapping eg ACharacter::Jump, APawn::Internal_AddMovementInput ADefaultPawn::MoveForward (see SetupPlayerInputComponent)
    - ProcessForceFeedbackAndHaptics => ..
  - UCharacterMovementComponent::TickComponent =>
    - ConsumeInputVector => UPawnMovementComponent::ConsumeInputVector => APawn::Internal_ConsumeMovementInputVector
    - ACharacter::CheckJumpInput => UCharacterMovementComponent::DoJump
    - PerformMovement => ..
      - ApplyAccumulatedForces, TickCharacterPose, ..
      - StartNewPhysics => PhysWalking, PhysFalling etc .. =>
        - UMovementComponent::SafeMoveUpdatedComponent, MoveUpdatedComponentImpl => USceneComponent::MoveComponent
```

- Unreal Engine Rendering
  - https://docs.unrealengine.com/latest/INT/Programming/Rendering/index.html
  - https://docs.unrealengine.com/latest/INT/Programming/Rendering/Overview/index.html
  - https://docs.unrealengine.com/latest/INT/Programming/Rendering/ShaderInPlugin/index.html
  - architecture (modules: RenderCore, Renderer, RHI)

```
[ Data structure ]

FSceneViewport < FViewport < FRenderTarget
'-' UGameViewportClient

FSceneViewFamilyContext < FSceneViewFamily
'-* FSceneView
'-' FScene < FSceneInterface
'-' FSceneViewport < FViewport < FRenderTarget

FDeferredShadingSceneRenderer < FSceneRenderer


[ Procedure ]

(Main thread)
- UGameEngine::Tick => RedrawViewports => FViewport::Draw =>
  - EnqueueBeginRenderFrame
  - UGameViewportClient::Draw =>
    - construct FSceneViewFamilyContext
    - ULocalPlayer::CalcSceneView => new FSceneView
    - FRendererModule::BeginRenderingViewFamily =>
      - ENQUEUE_RENDER_COMMAND(UpdateDeferredCachedUniformExpressions ..)
      - UWorld::SendAllEndOfFrameUpdates (telling renderer which rendering related components got dirty ?)
      - FSceneRenderer::CreateSceneRenderer => new FDeferredShadingSceneRenderer
      - ENQUEUE_UNIQUE_RENDER_COMMAND_ONEPARAMETER(FDrawSceneCommand RenderViewFamily_RenderThread ..)
    - Additionally draw ui, hud, subtitle, stats etc..

(Render thread)
- RenderingThreadMain => ProcessTasksUntilQuit => .. =>
  - FRendererModule::BeginRenderingViewFamily => RenderViewFamily_RenderThread(FRHICommandListImmediate, ..) =>
    - FDeferredShadingSceneRenderer::Render => ..
```


# 2017-10-23

- random stuff
  - OpenGEX: http://opengex.org/comparison.html
  - gimbal lock
      - https://en.wikipedia.org/wiki/Euler_angles
      - https://en.wikipedia.org/wiki/Gimbal_lock

- Unreal engine shader dev
  - https://rcaloca.blogspot.jp/2017/05/adding-global-shaders-to-ue4.html
  - ELoadingPhase::PostConfigInit
  - console command, console variable
  - Shader program lifecycle (.usf source, .glsl compilation, cache)

```
[ Data structure ]

static GGlobalShaderMap, GShaderTypeList, GShaderNameToTypeMap (each Shader adds itself during its ShaderType constructor)

FFooShaderVS < FGlobalShader < FShader
FGlobalShaderType < FShaderType

DECLARE_SHADER_TYPE   --> declare static FGlobalShaderType FFooShaderVS::StaticType
IMPLEMENT_SHADER_TYPE --> define FooShaderVS::StaticType(.. "<usf source file>", "<function name>" ..)


[ Procedure ]

(Compilation at engine initialization)
- FEngineLoop::PreInit => CompileGlobalShaderMap =>
  - VerifyShaderSourceFiles => LoadShaderSourceFile
  - FDerivedDataCacheInterface::GetSynchronous ..
  - VerifyGlobalShaders =>
    - FGlobalShaderTypeCompiler::BeginCompileShader if it wasn't in DDC =>
      - GlobalBeginCompileShader => ..
    - FShaderCompilingManager::AddJobs (FShaderCompileThreadRunnable is waiting for job)
    - FShaderCompilingManager::FinishCompilation =>
      - BlockOnShaderMapCompletion
      - ProcessCompiledShaderMaps =>
        - ProcessCompiledGlobalShaders => ProcessCompiledJob =>
          - FGlobalShaderTypeCompiler::FinishCompileShader

(Recompilation console command)
- UEngine::Exec => HandleRecompileShadersCommand => RecompileShaders =>
  - FShaderType::GetOutdatedTypes
  - BeginRecompileGlobalShaders => CompileGlobalShaderMap ..
  - FinishRecompileGlobalShaders => ..

(Main process spawning ShaderCompileWorker)
- FShaderCompileThreadRunnable::CompilingLoop =>
  - LaunchWorkersIfNeeded =>
    spawn something like `ShaderCompileWorker <tmp working dir> 29090 0 WorkerInputOnly.in WorkerOutputOnly.out
                            -communicatethroughfile  -logcmds="Global None"  -Multiprocess`
  - ReadAvailableResults => ..

(ShaderCompileWorker)
- FWorkLoop::Loop =>
  - ProcessInputFromArchive => ProcessCompilationJob =>
    - FShaderFormatGLSL::CompileShader =>
      - FOpenGLFrontend::CompileShader =>
        - DoPreprocess => PreprocessShader => mcpp_run (thirdparty)
        - dump preprocessed files into DumpDebugInfoPath
        - CreateBackend => new FGlslCodeBackend
        - FHlslCrossCompilerContext::Init, Run
  - WriteToOutputArchive ..
```


# 2017-10-24

- Unreal engine material shader
  - material shader compilation
  - runtime shader management
  - post process volume
  - https://docs.unrealengine.com/latest/INT/Engine/Rendering/PostProcessEffects/PostProcessMaterials/index.html

```
[ Data structure ]

FMaterial
FMaterialShaderMap < TShaderMap<FMaterialShaderType>
FPostProcessMaterialPS < FMaterialShader < FShader
IMPLEMENT_MATERIAL_SHADER_TYPE(.. FFPostProcessMaterialPS_HighEnd "/Engine/Private/PostProcessMaterialShaders.usf" ..)

TBasePassVS < TBasePassVertexShaderBaseType < TBasePassVertexShaderPolicyParamType < FMeshMaterialShader < FMaterialShader ..

FLocalVertexFactory < FVertexFactory
IMPLEMENT_VERTEX_FACTORY_TYPE(FLocalVertexFactory,"/Engine/Private/LocalVertexFactory.ush", ..);

IMPLEMENT_UNIFORM_BUFFER_STRUCT(FPrecomputedLightingParameters, TEXT("PrecomputedLightingBuffer"))

FSceneView
'-' FFinalPostProcessSettings < FPostProcessSettings

UCameraComponent, APostProcessVolume, UPostProcessComponent ..
'-' FPostProcessSettings

FRCPassPostProcessMaterial < TRenderingCompositePassBase < FRenderingCompositePass

FOpenGLDynamicRHI < FDynamicRHI, IRHICommandContext

TOpenGLShader < RHIResourceType
typedef TOpenGLShader<FRHIPixelShader, GL_FRAGMENT_SHADER, SF_Pixel> FOpenGLPixelShader
FRHIPixelShader < FRHIShader < FRHIResource
typedef TRefCountPtr<FRHIPixelShader> FPixelShaderRHIRef


[ Procedure ]

(Material shader compilation)
- FMaterialEditor::SaveAsset_Execute => UpdateOriginalMaterial => .. =>
  - FMaterial::CacheResourceShadersForRendering => .. => BeginCompileShaderMap =>
    - new FMaterialShaderMap
    - FHLSLMaterialTranslator::Translate =>
      - Obtain shader program infomation from editor graph nodes and material property.
        validation happens here too. based on "/Engine/Private/MaterialTemplate.ush"
    - new FShaderCompilerEnvironment
    - FHLSLMaterialTranslator::GetMaterialShaderCode and put them into "/Engine/Generated/Material.ush"
    - FMaterialShaderMap::Compile =>
      - FMeshMaterialShaderMap::BeginCompile for all vertex factory types (eg LocalVF/BPPSFNoLMPol/ (ie base pass pixel shader ..))
      - new FMeshMaterialShaderMap
      - FMeshMaterialShaderMap::BeginCompile for each vertex factory (eg LocalVF (LocalVertexFactory)) =>
        - FMeshMaterialShaderType::BeginCompileShader (eg LocalVF/BPVSXXX) =>
          - new FShaderCompileJob
          - FVertexFactoryType::ModifyCompilationEnvironment =>
            - IncludeVirtualPathToContentsMap.Add(TEXT("/Engine/Generated/VertexFactory.ush") "#include /Engine/Private/LocalVertexFactory.ush" ..)
          - GlobalBeginCompileShader => final "define" setup with checking console variables + prepare DumpDebugInfoPath if r.ShaderDevelopmentMode
      - FMaterialShaderType::BeginCompileShader (eg PostMaterialPS_HighEnd/PostProcessMaterialShaders.usf)
      - FShaderCompilingManager::AddJobs
      - ..


(Material shader (see preprocessed (mcpp-ed) PostProcessMaterialShaders.usf))
- Main_VS (just drawing quad)
- Main_PS => CalcMaterialParametersPost => CalcMaterialParametersEx =>
  - CalcPixelMaterialInputs (here is what converted from graph nodes expressions)


(Using post process material)
- (main thread) FEditorViewportClient::Draw =>
  - FLevelEditorViewportClient::CalcSceneView => FEditorViewportClient::CalcSceneView =>
    - FSceneView::StartFinalPostprocessSettings
      - update FinalPostProcessSettings based on console variables and UWorld::PostProcessVolumes
      - DoPostProcessVolume => OverridePostProcessSettings =>
        - UMaterialInterface::OverrideBlendableSettings

- (render thread) FDeferredShadingSceneRenderer::Render =>
  - FPostProcessing::Process =>
    - AddPostProcessMaterial =>
      - IteratePostProcessMaterialNodes (based on FSceneView::FinalPostProcessSettings)
      - new FRCPassPostProcessMaterial
      - FRenderingCompositionGraph::RegisterPass
    - FRenderingCompositePassContext::Process => FRenderingCompositionGraph::RecursivelyProcess =>
    - FRCPassPostProcessMaterial::Process =>
      - GETSAFERHISHADER_PIXEL(PixelShader_HighEnd) --> FShaderResource::GetPixelShader
      - FRHICommandList::SetLocalGraphicsPipelineState => .. => FOpenGLDynamicRHI::RHICreateBoundShaderState
      - DrawPostProcessPass => DrawRectangle =>
        - FRHICommandList::DrawIndexedPrimitive => FOpenGLDynamicRHI::RHIDrawIndexedPrimitive => glDrawElements ..


(GLSL comilation, linking, using)
- FShaderResource::GetPixelShader => .. =>
  - FOpenGLDynamicRHI::RHICreatePixelShader =>
    - CompileOpenGLShader<FOpenGLPixelShader> =>
      - FOpenGL::CreateShader => glCreateShader
      - CompileCurrentShader => glShaderSource, glCompileShader
      - new FOpenGLPixelShader (somehow compatible with FPixelShaderRHIRef)

- FOpenGLDynamicRHI::RHICreateBoundShaderState =>
  - LinkProgram =>
    - FOpenGL::GenProgramPipelines => glCreateProgram
    - FOpenGL::UseProgramStages => glAttachShader
    - glLinkProgram
    - FOpenGL::BindProgramPipeline => glUseProgram
  - new FOpenGLBoundShaderState
```


# 2017-10-24

- unreal engine: visual programming, reflection
  - compilation, execution
  - cf
      - https://docs.unrealengine.com/latest/INT/Engine/Blueprints/TechnicalGuide/Compiler/index.html
      - https://docs.unrealengine.com/latest/INT/Programming/Slate/Architecture/index.html
      - https://www.unrealengine.com/en-US/blog/unreal-property-system-reflection

```
[ Data structure ]

FBlueprintEditor < IBlueprintEditor < FWorkflowCentricApplication < FAssetEditorToolkit < FBaseToolkit
'-' EditingObjects (UBlueprint)
'-' ToolkitCommands
'-' SGraphEditor
'-' SBlueprintPalette
'-' SMyBlueprint
'-' ..

UBlueprint < UBlueprintCore < UObject
'-' UBlueprintGeneratedClass < UClass < UStruct < UField < UObject
'-' ParentClass (eg Z_Construct_UClass_AActor in Actor.generated.h)

UProperty < UField


[ Procedure ]

(Create blueprint)
- SContentBrowser::NewAssetRequested =>
  - NewObject<UFactory>
  - UBlueprintFactory::ConfigureProperties => SClassPickerDialog::PickClass
  - SAssetView::CreateNewAsset

- SAssetView::AssetRenameCommit .. UBlueprintFactory::FactoryCreateNew =>
  - FKismetEditorUtilities::CreateBlueprint =>
    - NewObject<UBlueprint>
    - NewObject<UBlueprintGeneratedClass>
    - FBlueprintEditorUtils::CreateNewGraph, AddFunctionGraph
    - CreateDefaultEventGraphs
    - FKismet2CompilerModule::CompileBlueprint

(Open blueprint editor)
- SlateApplication event dispath .. SContentBrowser::OnAssetsActivated .. FBlueprintEditorModule::CreateBlueprintEditor =>
  - new FBlueprintEditor
  - FBlueprintEditor::InitBlueprintEditor =>
    - InitAssetEditor => append to EditingObjects
    - CommonInitialization =>
      - new FGraphEditorSummoner
      - CreateDefaultCommands =>
        - FFullBlueprintEditorCommands::RegisterCommands =>
          - UI_COMMAND(Compile, "Compile", "Compile the blueprint", EUserInterfaceActionType::Button, FInputChord())
        - FUICommandList::MapAction(.. FBlueprintEditor::Compile ..)
      - CreateDefaultTabContents ..
    - RegisterApplicationModes => .. => FBlueprintEditorToolbar::FillCompileToolbar => AddToolBarButton ..

(Compile blueprint)
- SToolBarButtonBlock::OnClicked .. FBlueprintEditor::Compile => FKismetEditorUtilities::CompileBlueprint =>
  - FBlueprintCompilationManager::CompileSynchronously => FlushCompilationQueueImpl =>
    - .. complicated logic ..
    - FKismetCompilerContext::CompileClassLayout =>
      - SpawnNewClass => NewObject<UBlueprintGeneratedClass>
      - CreateClassVariablesFromBlueprint => CreateVariable => NewObject<UXXXProperty>
      - CreateFunctionList => ..
      - PrecompileFunction =>
        - NewObject<UFunction>
        - UClass::AddFunctionToFunctionMap
        - ..
      - UClass::Bind, Link
    - FKismetCompilerContext::CompileFunctions =>
      - CreateLocalsAndRegisterNets =>
        - CreateExecutionSchedule
        - FKCHandler_GetVariable::RegisterNets
        - CreateLocalVariablesForFunction => ..
      - CompileFunction
        - FKismetFunctionContext::AppendStatementForNode => new FBlueprintCompiledStatement
        - FKCHandler_XXX::Compile (eg FKCHandler_CallFunction) => ..
      - FKismetCompilerVMBackend::GenerateCodeFromClass => ConstructFunction =>
        - FScriptBuilderBase::GenerateCodeForStatement ..
      - (optionally FBlueprintCompilerCppBackendBase::GenerateCodeFromClass ..)

(Kismet VM execution (I tested with simple "Tick" (or "S key") -> "Actor set scale" graph and adding breakpoint to "Actor set scale"))
- UPlayerInput::ProcessInputStack .. UObject::ProcessEvent =>
  - UFunction::Invoke =>
    - UObject::ProcessInternal (byte code execution) => FFrame::Step (calling GNatives[CodeAddress] (eg UObject::CallFunction))
      - .. => UObject::CallFunction => UFunction::Invoke =>
        - AActor::execSetActorScale3D (see TNameNativePtrPair in Actor.gen.cpp) => SetActorScale3D ..

- AActor::Tick => AActor::ReceiveTick (this function is BlueprintImplementableEvent and "Tick" is only DisplayName. see Actor.gen.cpp) =>
  - FindFunctionChecked(NAME_AActor_ReceiveTick) and UObject::ProcessEvent => ..
```

# 2017-10-26

- unreal lighting
  - https://docs.unrealengine.com/latest/INT/Resources/ContentExamples/Lighting/index.html

- static, stationary light
  - precomputing
      - volume light map (for dynamic mesh):
          - https://docs.unrealengine.com/latest/INT/Engine/Rendering/LightingAndShadows/VolumetricLightmaps/index.html
      - per-mesh surface light map (for static mesh):
          - https://docs.unrealengine.com/latest/INT/Engine/Rendering/LightingAndShadows/LightMobility/StaticLights/index.html
  - (dynamich mesh)
      - [ ] per object shadow (frustrum)
      - [ ] directional light's CSM

- dynamic light
  - (for static mesh)
    - per fragment https://docs.unrealengine.com/latest/INT/Engine/Rendering/LightingAndShadows/RayTracedDistanceFieldShadowing/index.html
        - SDF construction and its runtime representaion (3d texture ?)
        - can mesh move ????
    - shadow map (per light)
  - (for dynamic mesh)
    - shadow map (per light)
    - contact shadow (per mesh fragment)


# 2017-10-27

- Unreal engine rendering passes
  - super rough `FDeferredShadingSceneRenderer::Render` follow up
  - https://docs.unrealengine.com/latest/INT/Programming/Rendering/Overview/index.html
  - https://docs.unrealengine.com/latest/INT/Engine/Components/Rendering/index.html

```
[ Data structure ]
FSceneRenderTargets
'-* IPooledRenderTarget (eg SceneDepthZ, GBufferA-E, Velocity ..)
'-' rendering settings (eg buffer size/format .. )

FDeferredShadingSceneRenderer < FSceneRenderer
'-' FScene
  '-* FPrimitiveSceneInfo, FStaticMesh, FLightSceneInfoCompact ..
  '-* TStaticMeshDrawList for different drawing policies (eg FDepthDrawingPolicy, WholeSceneShadowDepthDrawList ..)
  '-' FFXSystem
'-* FViewInfo
  '-' FSceneViewState

(Main thread entities)
UObject > UActorComponent > USceneComponent > UPrimitiveComponent
UPrimitiveComponent > UShapeComponent
                    > UMeshComponent > UStaticMeshComponent
                                     > USkinnedMeshComponent > USkeletalMeshComponent

(Drawing policy example)
FPositionOnlyDepthDrawingPolicy < FMeshDrawingPolicy
'-' FVertexFactory
'-' TDepthOnlyVS < FMeshMaterialShader

FDrawingPolicyRenderState (temporary constructed for each pass)


[ Procedure ]
- FDeferredShadingSceneRenderer::Render =>
  - .. => FSystemTextures::InternalInitializeTextures (setup some LUT textures eg noise)
  - FSceneRenderTargets::Allocate => AllocateRenderTargets => AllocateDeferredShadingPathRenderTargets =>
    - prepare some of render targets (buffers) by FRenderTargetPool::FindFreeElement ..
  - FSceneRenderTargets::InitViews =>
    - ComputeViewVisibility =>
      - primitive, static mesh, lights from FScene to FViewInfo, culling primitives
      - GatherDynamicMeshElements
    - PostVisibilityFrameSetup =>
      - sort translucent, decal
      - culling lights
    - FDeferredShadingSceneRenderer::InitViewsPossiblyAfterPrepass =>
      - InitDynamicShadows =>
        - AddViewDependentWholeSceneShadowsForView
        - SetupInteractionShadows =>
          - CreatePerObjectProjectedShadow
        - InitProjectedShadowVisibility
        - ..
      - UpdatePrimitivePrecomputedLightingBuffers =>
        - FPrimitiveSceneInfo::UpdatePrecomputedLightingBuffer =>
          - FStaticMeshSceneProxy::GetLCIs
          - CreatePrecomputedLightingUniformBuffer
          - FLightCacheInterface::SetPrecomputedLightingBuffer
    - FViewInfo::InitRHIResources => ViewUniformShaderParameters
  - UpdateGlobalDistanceFieldObjectBuffers, UpdateGlobalDistanceFieldVolume
  - FFXSystem::PreRender => SimulateGPUParticles ..
  - RenderPrePass =>
    - RenderPrePassView =>
      - FDrawingPolicyRenderState DrawRenderState
      - SetupPrePassView => update FDrawingPolicyRenderState (eg blend, scissor etc..)
      - TStaticMeshDrawList::DrawVisible => DrawElement =>
        - FMeshDrawingPolicy::SetupPipelineState
        - construct FBoundShaderStateInput and CommitGraphicsPipelineState => FRHICommandList::SetLocalGraphicsPipelineState ..
        - FPositionOnlyDepthDrawingPolicy::SetMeshRenderState => TDepthOnlyVS::SetMesh => FMeshMaterialShader::SetMesh =>
          - FLocalVertexFactoryShaderParameters::SetMesh ..
        - FMeshDrawingPolicy::DrawMesh => FRHICommandList::DrawIndexedPrimitive
      - RenderPrePassViewDynamic => ..
  - FSceneRenderTargets::AllocGBufferTargets =>FRenderTargetPool::FindFreeElement for GBufferA-E
  - RenderOcclusion => BeginOcclusionTests, BuildHZB ..
  - RenderShadowDepthMaps => FSceneRenderer::RenderShadowDepthMapAtlases => FProjectedShadowInfo::RenderDepth ..
  - ComputeLightGrid => TLightGridInjectionCS
  - FCompositionLighting::ProcessBeforeBasePass =>
    - FRenderingCompositionGraph::RegisterPass new FRCPassPostProcessDeferredDecals ..
  - RenderBasePass => RenderBasePassView =>
    - SetupBasePassView
    - RenderBasePassStaticData => RenderBasePassStaticDataType =>
      - Scene->BasePassUniformLightMapPolicyDrawList[DrawType].DrawVisible (aka TStaticMeshDrawList::DrawVisible), DrawElement =>
        - (mesh surface material shader is setup during FStaticMesh::AddToDrawLists)
        - TBasePassDrawingPolicy::SetupPipelineState => ..
        - TBasePassDrawingPolicy::SetMeshRenderState =>
          - FUniformLightMapPolicy::SetMesh => SetUniformBufferParameter ..
          - TBasePassPixelShaderPolicyParamType::SetMesh ..
        - DrawMesh ..
    - RenderBasePassDynamicData => ..
  - FFXSystem::PostRenderOpaque
  - RenderVelocities
  - RenderLights =>
    - (many light variations eg simple, tiled, translucent, unshadowed, light material, LPV calculation, ..)
    - RenderShadowProjections =>
      - FSceneRenderer::RenderShadowProjections =>
        - FProjectedShadowInfo::RenderProjection =>
          - SetupFrustumForProjection
          - GetShadowProjectionShaders => FShadowVolumeBoundProjectionVS, TShadowProjectionPS
          - DrawIndexedPrimitiveUP
    - FSceneRenderTargets::BeginRenderingSceneColor, RenderLight =>
      - TDeferredLightVS
      - SetShaderTemplLighting => TDeferredLightPS
      - DrawRectangle (screen quad)
  - RenderDynamicSkyLighting
  - ResolveSceneColor => FRHICommandList::CopyToResolveTarget
  - FCompositionLighting::ProcessAfterLighting (screen-space sss)
  - RenderLightShaftOcclusion
  - RenderAtmosphere
  - RenderTranslucency
  - RenderDistortion (for refraction)
  - RenderLightShaftBloom
  - RenderDistanceFieldLighting
  - ResolveSceneColor
  - CopySceneCaptureComponentToTarget
  - FPostProcessing::Process => ..
  - RenderFinish

(Static mesh)
- FScene::AddPrimitive => AddPrimitiveSceneInfo_RenderThread =>
  - FPrimitiveSceneInfo::AddToScene => AddStaticMeshes => FStaticMesh::AddToDrawLists =>
    - FBasePassOpaqueDrawingPolicyFactory::AddStaticMesh =>
      - construct FProcessBasePassMeshParameters (eg FMaterial), FDrawBasePassStaticMeshAction (eg StaticMesh)
      - ProcessBasePassMesh =>
        - FLightCacheInterface::GetLightMapInteraction => FLightMap2D::GetInteraction
        - FLightCacheInterface::GetShadowMapInteraction => FShadowMap2D::GetInteraction
        - FDrawBasePassStaticMeshAction::Process =>
          - construct TBasePassDrawingPolicy<LightMapPolicyType> (from StaticMesh's VertexFactory, Material) =>
            - GetBasePassShaders<LightMapPolicyType> =>
              - GetUniformBasePassShaders<LMP_DISTANCE_FIELD_SHADOWS_AND_HQ_LIGHTMAP> =>
                - FMaterial::GetShader<TBasePassVS<TUniformLightMapPolicy<Policy>,false>>(VertexFamily)
                  (eg Saved/ShaderDebugInfo/GLSL_430/BasicShapeMaterial/LocalVF/BPPSTDistFielShdwsAndLMPolHQ)
                - GetShader<TBasePassPS ..> too
          - TStaticMeshDrawList::AddMesh
```

- Unreal engine value formatter for lldb
  - https://lldb.llvm.org/varformats.html
  - UE4DataFormatters.py (type summary and type synthetic for `TCHAR`, `FString`, `FName` ..)


# 2017-10-27

- unreal engine rendering (basic shader programs in detail)
  - "Generated" files (Material.ush, VertexFactory.ush, UniformBuffers/PrecomputedLightingBuffer.ush)
  - Base pass shader (precomputed light's contribution to scene color calculation)
  - Direct light pass shader (BRDF)
  - Dynamic shadow

```
===============
== Base pass ==
===============

[ Data structure ]

FVertexFactoryInput (LocalVertexFactory.ush)
'-' Position : ATTRIBUTE0
'-' ..

FMaterialVertexParameters (MaterialTemplate.ush)
'-' WorldPosition
'-' VertexColor
'-' FMaterialParticleParameters
'-' ..

 || VS + Material
 \/

FBasePassVSOutput (or FBasePassVSToPS) (BasePassVertexCommon.ush)
'-' FVertexFactoryInterpolantsVSToPS (LocalVertexFactoryCommon.ush)
  '-' vertex color
  '-'
'-' FBasePassInterpolantsVSToPS < FSharedBasePassInterpolants (BasePassCommon.ush)
  '-' vertex lighting
'-' Position : SV_POSITION

FMaterialPixelParameters (MaterialTemplate.ush)
'-' ..

 || PS + Material
 \/

FGBufferData (DeferredShadingCommon.ush)
'-' ShadingModelID (eg DEFAULT_LIT, HAIR, FOLIAGE, ..)
'-' BaseColor, Metallic, Roughness ..

FPixelShaderOut (Common.ush)
'-' up to 8 MRTs


[ Procedure ]

- Main (BasePassVertexShader.usf) =>
  - GetMaterialVertexParameters (LocalVertexFactory.ush)
  - GetMaterialWorldPositionOffset (MaterialTemplate.ush)
  - VertexFactoryGetInterpolants (or VertexFactoryGetInterpolantsVSToPS) (LocalVertexFactory.ush) =>
    - GetMaterialCustomizedUVs (MaterialTemplate.ush)
    - ..

- MainPS (PixelShaderOutputCommon.ush) =>
  - FPixelShaderInOut_MainPS (BasePassPixelShader.usf) =>
    - GetMaterialPixelParameters (LocalVertexFactory.ush)
    - CalcMaterialParametersEx (MaterialTemplate.ush) =>
      - CalcPixelMaterialInputs (This is where custom material expression is compiled into)
    - GetMaterialBaseColor, Metallic, Specular .. (MaterialTemplate.ush)
    - SetGBufferForShadingModel (ShadingModelsMaterial.ush)
    - GetPrecomputedIndirectLightingAndSkyLight (BasePassPixelShader.usf) =>
      - (Various exclusive patterns of precomputed indirect light eg volumetric lightmap, 2d lightmap)
      - GetVolumetricLightmap (VolumetricLightmapShared.ush)
      - CalcDiffuseTransferSH3 (SHCommon.ush (Spherical Harmonics))
      - GetLightMapCoordinates (LocalVertexFactoryCommon.ush)
      - GetLightMapColorHQ/LQ (LightmapCommon.ush)
      - ..
    - LightAccumulator_Add (for sss ?) (LightAccumulator.ush)
    - LightAccumulator_GetResult as Out.MRT[0] (aka SceneColor)
    - EncodeGBuffer (DeferredShadingCommon.ush)


===================================
== Deferred direct lighting pass ==
===================================

[ Data structure ]
FScreenSpaceData (DeferredShadingCommon.ush)
'-' FGBufferData

FDeferredLightData (copy of DeferredLightUniforms)

[ Procedure ]

- DirectionalPixelMain (DeferredLightPixelShaders.usf) =>
  - GetScreenSpaceData (DeferredShadingCommon.ush) => GetGBufferData (sample from base pass's MRTs)
  - SetupLightDataForStandardDeferred (DeferredLightPixelShaders.usf)
  - GetPerPixelLightAttenuation => sample LightAttenuationTexture (shadow map prepared by previous RenderShadowProjections pass ?)
  - OutColor = GetDynamicLighting (DeferredLightingCommon.ush (beautifully resued from ForwardLightingCommon.ush too ?)) =>
    - GetShadowTerms => can switch to GBuffer.PrecomputedShadowFactors from GetPerPixelLightAttenuation's dynamic shadowing
    - ShadowRayCast (contact shadow)
    - SurfaceShading (ShadingModels.ush) => StandardShading =>
      - (NOTE: indirect light contribution is merged into base (diffuse) color during base pass)
      - Diffuse_Lambert (BRDF.ush)
      - (Specular) F_Schlick, D_GGX, Vis_SmithJointApprox  (BRDF.ush)
    - SubsurfaceShading => ..
```


- Epic Games Launcher on Wine
  - https://appdb.winehq.org/objectManager.php?sClass=application&iId=17444
  - https://lutris.net/games/epic-games-launcher/
  - https://www.reddit.com/r/wine_gaming/comments/6q7gze/fortnite_paragon_epic_games_launcher_working_in/
  - didn't work .. gotta try VM
  - https://wiki.unrealengine.com/Linux_Demos
  - https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/


- Unreal engine transparent stuff
  - https://docs.unrealengine.com/latest/INT/Engine/Rendering/LightingAndShadows/LitTranslucency/index.html
  - https://docs.unrealengine.com/latest/INT/Engine/Rendering/Materials/MaterialProperties/index.html#translucency

```
- FDeferredShadingSceneRenderer::Render => RenderTranslucency =>
  - FTranslucentPrimSet::DrawPrimitives =>
    - FDeferredShadingSceneRenderer::PrepareTranslucentShadowMap ..
    - RenderPrimitive => FTranslucencyDrawingPolicyFactory::DrawDynamicMesh => DrawMesh =>
      - construct FProcessBasePassMeshParameters, FDrawTranslucentMeshAction (anyway using base pass shader ?)
      - ProcessBasePassMesh
```

# 2017-10-29

- Unreal engine volumetric lightmap
  - https://docs.unrealengine.com/latest/INT/Engine/Rendering/LightingAndShadows/VolumetricLightmaps/index.html

# 2017-10-30

- Brush engine
  - Unreal engine landscape tools: https://docs.unrealengine.com/latest/INT/Engine/Landscape/TechnicalGuide/index.html
  - Blender: https://docs.blender.org/manual/en/dev/sculpt_paint/index.html
  - Krita: https://docs.krita.org/Bristle

- Unreal engine landscape
  - https://docs.unrealengine.com/latest/INT/Engine/Landscape/TechnicalGuide/index.html
  - https://docs.unrealengine.com/latest/INT/Engine/Landscape/Materials/index.html#landscapelayerblendtechnicalinformation
  - FLandscapeVertexFactory (does this provide some additional vertex attributes ??)
  - is layer weight on vertex or texture ??
  - heightmap sculpting
  - material layer paint
  - viewport gizmo (decal ?)

- Noise
  - Unreal engine
  - material expression node implementation (default input value, etc..)
  - https://docs.unrealengine.com/latest/INT/Engine/Rendering/Materials/ExpressionReference/Utility/index.html
  - https://www.unrealengine.com/en-US/blog/getting-the-most-out-of-noise-in-ue4

```
[ Data structure ]
FHLSLMaterialTranslator < FMaterialCompiler

UMaterialExpressionNoise < UMaterialExpression
'-' FExpressionInput (position, filter width)
'-' ..


[ Procedure ]
- FHLSLMaterialTranslator::Translate =>
  - .. => UMaterialExpressionNoise::Compile =>
    - check if expression is connected to other expression. if not, fallback to world position and constant 0
    - FHLSLMaterialTranslator::Noise =>
      - AddCodeChunk( "MaterialExpressionNoise .." )


[ Generated material code (Generated/Material.ush) ]
- CalcPixelMaterialInputs =>
  - MaterialExpressionNoise (Common.ush) => Noise3D_Multiplexer => VoronoiNoise3D_ALU (Random.ush) =>
    -
```

- Unreal engine particle
  - StarterContent/Particles/P_Fire
  - gpu particle collision scene depth
  - sub uv sprite animation
  - cpu particle light (how dynamic this is)

- [ ] Spherical harmonics

- [ ] Unreal engine foliage

- windows installation
  - now, of course, all OEM-ed partitions are gone, what can I do ?
  - https://www.howtogeek.com/244678/you-dont-need-a-product-key-to-install-and-use-windows-10/
  - http://www.zdnet.com/article/microsoft-quietly-rewrites-its-activation-rules-for-windows-10/
  - https://www.microsoft.com/en-us/software-download/windows10ISO
  - dual boot: https://wiki.archlinux.org/index.php/Dual_boot_with_Windows

- unreal engine
  - https://www.youtube.com/watch?v=zzmt8UdUDek
  - https://www.youtube.com/watch?v=ihg4uirMcec


# 2017-10-31

- windows adoption
  - install
       - download iso
       - `dd` didn't work. used microsoft download tool
       - uefi boot to usb, which lets you use gpt
       - dual boot by refind (with auto discovoery of archlinux and windows)
  - cygwin
       - https://cygwin.com/
       - apt-cyg: easier sygwin package installation: https://github.com/transcode-open/apt-cyg
       - python3, pip, tmux, git
       - install ranger from source
  - unreal engine dev
       - vscode build task (powershell didn't let me run .bat so switch to cmd.exe)
       - install dependencies and tools via visual studio
       - vscode (disable intellisense since it burns my PC)
  - capslock as ctrl: https://github.com/randyrants/sharpkeys
       - programmically modify `Registry`
       - MSBuild from source
       - MSBuild installed via visual studio
  - [ ] share files with Linux (allocate windows friendly partition and access from both)
  - [ ] Linux subsystem for windows
       - https://blogs.msdn.microsoft.com/wsl/2016/04/22/windows-subsystem-for-linux-overview/
  - vlc (music player)


# 2017-11-01

- Noise
  - http://weber.itn.liu.se/~stegu/simplexnoise/simplexnoise.pdf
  - https://prettyprocs.wordpress.com/2012/10/20/fast-perlin-noise/
  - Gradient: Tri PerlinRamp interpolation
  - Texture look up technique: (eg `FSystemTextures::InternalInitializeTextures` and `FastGradientPerlinNoise3D_TEX`)
  - Simplex (sum of gradients instead of interpolation)
  - Voronoi (Worley)
  - Unreal Engine ("Level" iteration for combining octave frequency noise)
  - [ ] 3D noise volume rendering: http://shaderbits.com/blog/authoring-pseudo-volume-textures


# 2017-11-02

- Unreal engine
  - render target drawing additive material: ContentExample > BlueprintRenderToTarget > HeightfieldPainter (ForceSplat)
  - render target compute material: ContentExample > BlueprintRenderToTarget > WaterSurface_BP (HeightSim, ComputeNormal)

- Normal map from height map
  - unreal's material function graph looks complicated than what really is simple ..

```
/           0             \     /          d            \
|           d             |  x  |          0            |
\  h(u + d, v) - h(u, v)  /     \ h(u, v + d) - h(u, v) /
```

- Unreal engine Water plane example
  - modulate normal and roughness from noise (kind of bent Voronoi) with Motion_4WayChaos material function
  - opacity and color from scene depth (opaque) and pixel depth (transluency)
  - ocean: foam, height offset (tessellation)

- Differential equation
  - wave equation, heat equation
  - Linear 2nd order partial differential equation
  - https://en.wikipedia.org/wiki/Partial_differential_equation
  - https://en.wikipedia.org/wiki/Wave_equation
  - https://en.wikipedia.org/wiki/Heat_equation
  - https://en.wikipedia.org/wiki/Numerical_analysis
  - https://en.wikipedia.org/wiki/Finite_difference_method
  - https://en.wikipedia.org/wiki/Explicit_and_implicit_methods
  - https://en.wikipedia.org/wiki/Gradient
  - https://en.wikipedia.org/wiki/Divergence
  - https://en.wikipedia.org/wiki/Divergence_theorem
  - https://developer.nvidia.com/gpugems/GPUGems/gpugems_ch38.html
  - the rate of the rate of change ~ divergence of gradience of scalar field

- Water surface simulation (immitation)
  - http://vterrain.org/Water/index.html
  - vertex offset
  - pixel offset
  - http://www.valvesoftware.com/publications/2010/siggraph2010_vlachos_waterflow.pdf

- Spherical harmonics
  - https://en.wikipedia.org/wiki/Spherical_harmonics
  - https://en.wikipedia.org/wiki/Table_of_spherical_harmonics
  - SHCommon.ush (one/two/three band)
  - how is Volumetric lightmap encoded in 3d texture ??
  - direction, color, irradiance ??


# 2017-11-03, 2017-11-04

- 1D version of UnrealEngine HeightSim shader
  - https://en.wikipedia.org/wiki/Wave_equation
  - http://eqworld.ipmnet.ru/
  - https://en.wikipedia.org/wiki/Conic_section
  - https://www.shadertoy.com/view/XtScRd

```
Finite difference method

U_tt = c^2 * U_xx

(u(x, t + p) - 2 * u(x, t) + u(x, t - p)) / (p * p) =
(c * c) * (u(x + q, t) - 2 * u(x, t) + u(x - q, t)) / (q * q)

(u(x, t + p) - 2 * u(x, t) + u(x, t - p)) / (p * p) =
(c * c) * (u(x + q, t) - 2 * u(x, t) + u(x - q, t)) / (q * q)

  A                       u(x, t+p)
B C D    <=>    u(x-q, t)  u(x, t)  u(x+q, t)
  E                       u(x, t-p)

(A - 2 * C + E) / p^2 = (B - 2 * C + D) / (c^2 / q^2)

A = (p^2 * c^2 / q^2) * (B - 2 * C + D) - E + 2 * C
```


# 2017-11-06

- signed distance field raymarch
  - https://www.shadertoy.com/view/MlscWX
  - 3d model (just a combination of basic geometries)
  - material (define material property for geometry (and location), calculate based on raymarch hit result)
  - normal (calculate a gradient of a scalar field)
  - texturing (calculate uv location from hit result)
  - http://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm

- 3d viewport transformation
  - eg unreal engin's `EditorViewportClient.cpp`, `IsOrbitPanMode`


# 2017-11-07

- position texture
  - http://shaderbits.com/blog/uv-dilation
  - move mesh's vertex (aka World Position Offset output) to single plane based on lightmap texture coordinate (aka TexCoord[1])
  - each pixel writes local position onto that plane (and SceneCapture2D will render that to RenderTarget)
  - `UGameplayStatics::FindCollisionUV`, `UBodySetup::CalcUVAtLocation` will do similar thing ?
  - RenderTarget's property `AddressX`, `AddressY` should be `TA_Wrap`


# 2017-11-08

- Unreal engine actor (re)construction

```
- UWorld::SpawnActor (LevelActor.cpp) => AActor::PostSpawnInitialize => FinishSpawning =>
  - ExecuteConstruction (ActorConstruction.cpp) => USimpleConstructionScript::ExecuteScriptOnActor

- AActor::PostEditChangeProperty (ActorEditor.cpp) =>
  - RerunConstructionScripts (ActorConstruction.cpp) => ExecuteConstruction ..
```

- Unreal engine features
  - spline
  - animation
      - https://docs.unrealengine.com/latest/INT/Engine/Animation/Overview/index.html#systembreakdown
      - sequence, aim offset, blend space, montage??, animation blueprint (aka `UAnimBlueprint`, `UAnimInstance`)
      - root motion, physics-based animation (`USkeletalMeshComponent::SetAllBodiesBelowSimulatePhysics`), retargeting??
      - mesh, skeleton (bones), physics (collision mesh)
      - bones --(body setup) --> collision mesh
      - bones --(vertex skinning)--> mesh

- density function (distance field) noise terrain
  - https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch01.html

- distance field raymarch in unreal engine
  - https://www.youtube.com/watch?v=HaUAfgrZjlU

- windows setup
  - backup vscode setting
  - password management
  - unreal engine source code accessor
  - git (powershell (git bash) or cygwin)
  - cygwin

- volumetric rendering
  - https://developer.nvidia.com/gpugems/GPUGems/gpugems_ch39.html
  - http://shaderbits.com/blog/creating-volumetric-ray-marcher
  - http://shaderbits.com/blog/ray-marched-heightmaps
  - https://www.youtube.com/watch?v=N4mkgbwLg7U


# 2017-11-09

- Unreal engine shader hack
  - turn on `r.DumpShaderDebugInfo = "1"` and read preprocessed (ie "#include" is resolved) `BasePassPixelShader.usf`
  - global stuff: `cbuffer View` (eg `View_GameTime`) and `static ViewState ResolvedView`
  - [ ] material uniform parameter: `cbuffer Material` (`Material_VectorExpressions`, `Material_ScalarExpressions`)
  - custom hlsl node: access function as `CustomExpression0(Parameters, ..)`

- Unreal engine material function `PlotFunctionOnGraph` (expecting feedback)
  - material function is anyway broken down to nodes (it's kind of macro)
  - as long as there's no loop after macro-expansion, there's should be no problem.
  - kind of a way to implement higher order function.
  - but, it's not applicable to custom hlsl code.

- smooth min for blending field
  - http://www.iquilezles.org/www/articles/smin/smin.htm
  - https://en.wikipedia.org/wiki/Cubic_Hermite_spline


# 2017-11-10

- distance field
  - smooth intersection ??
  - smooth substraction
    - given d0 and d1, max(d0, d1)

- Volumetric Cloud
  - http://advances.realtimerendering.com/s2015/The%20Real-time%20Volumetric%20Cloudscapes%20of%20Horizon%20-%20Zero%20Dawn%20-%20ARTR.pdf
  - https://www.shadertoy.com/view/XslGRr
  - https://www.shadertoy.com/view/XtS3DD
  - http://shaderbits.com/blog/creating-volumetric-ray-marcher

- SIGGRAPH realtime course
  - http://advances.realtimerendering.com/s2017/index.html

- noise
  - Curl noise http://www.sidefx.com/docs/houdini/nodes/pop/curlnoise

- Shadertoy sound synthesize

- AR/VR rendering
  - AR Scene Depth
  - Stereo Eye

- procedual generation
  - https://www.youtube.com/watch?v=WumyfLEa6bU
  - L-system

- fake window with cubemap
  - scene capture inside
  - shader follow camera ray

- freeze pose but with running physics and world


# 2017-11-11

- physics
  - https://en.wikipedia.org/wiki/Chromatic_aberration
  - https://en.wikipedia.org/wiki/Light-emitting_diode
  - https://en.wikipedia.org/wiki/Electroluminescence
  - ...
  - https://en.wikipedia.org/wiki/Speed_of_light
  - https://en.wikipedia.org/wiki/Photon
  - https://en.wikipedia.org/wiki/Refractive_index
  - https://en.wikipedia.org/wiki/Huygens%E2%80%93Fresnel_principle
  - https://en.wikipedia.org/wiki/Fresnel_equations
  - [ ] https://en.wikipedia.org/wiki/Diffraction#Mechanism
  - [ ] https://en.wikipedia.org/wiki/Electromagnetic_radiation (production)
  - [ ] https://en.wikipedia.org/wiki/Light#Historical_theories_about_light.2C_in_chronological_order
  - ...
  - https://en.wikipedia.org/wiki/Proposed_redefinition_of_SI_base_units
  - [ ] https://en.wikipedia.org/wiki/Luminous_intensity

- random stuff
  - [ ] https://en.wikipedia.org/wiki/History_of_Earth
  - https://en.wikipedia.org/wiki/History_of_the_world
  - [ ] https://en.wikipedia.org/wiki/Life
  - [ ] https://en.wikipedia.org/wiki/Behavioral_modernity

- Biology
  - [ ] https://en.wikipedia.org/wiki/Life
  - [ ] https://en.wikipedia.org/wiki/Timeline_of_the_evolutionary_history_of_life
  - [ ] https://en.wikipedia.org/wiki/Homeostasis
  - [ ] https://en.wikipedia.org/wiki/Metabolism
  - [ ] https://en.wikipedia.org/wiki/Biology
  - https://en.wikipedia.org/wiki/Cell_signaling
  - [ ] https://en.wikipedia.org/wiki/Nucleic_acid


# 2017-11-12

- hdr image file format
  - http://radsite.lbl.gov/radiance/
  - https://en.wikipedia.org/wiki/RGBE_image_format
  - http://paulbourke.net/dataformats/pic/
  - https://en.wikipedia.org/wiki/IEEE_754-1985

- cubemap file format
  - https://github.com/dariomanesku/cmftStudio#supported-formats
  - capturing (real world (patching up overwrapped photos? some magic sphere ?), digital world (4 perspective cameras?))
  - gpu upload (6 square 2D textures)
  - sampling (3d vector)
  - https://www.khronos.org/opengl/wiki/Cubemap_Texture
  - Reference for DDS: https://msdn.microsoft.com/en-us/library/windows/desktop/bb943992.aspx
  - https://en.wikipedia.org/wiki/Cube_mapping

- unreal engine fake window shader
  - create texture from cubemap scene capture set within a room
  - shader samples cubemap by checking the intersection of line (camera to window vector) to box (room)

- random stuff
  - http://www.mcescher.com/gallery/
  - Balcony-like post process (turn on "filtered" (cf `SceneTextureLookup` and `BilinearTextureSampler0` in MaterialTemplate.ush))
  - Balcony-like translucent sheet (cf `DistortionPrimSet`, `FSceneRenderer::RenderDistortion`)
      - it's only pixel offset based on surface normal (no tracing back scene (ie not considering depth). of cource, if we really wanna tracing, it needs to be volume, not just a surface.)

- texture sampling basics
  - "automatic" mip level calculation (raw sampling is U: X * Y -> [0, 1] * [0, 1]. gpu can get dU/dx and dU/dy, how exactly ??)
  - projection, shadow
  - `BilinearTextureSampler0` in MaterialTemplate.ush
  - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)
  - Sampler type https://msdn.microsoft.com/en-us/library/windows/desktop/bb509644.aspx


# 2017-11-13

- windows stuff
  - vscode config file backup https://gitlab.com/hiogawa/config/tree/master/vscode
  - mklink
  - password management idea

- lens flare
  - http://resources.mpi-inf.mpg.de/lensflareRendering/
  - https://www.shadertoy.com/view/4sX3Rs, https://www.shadertoy.com/view/XtS3DD
  - https://en.wikipedia.org/wiki/Lens_flare
  - https://en.wikipedia.org/wiki/Diffraction_spike
      - diffraction: https://en.wikipedia.org/wiki/Fraunhofer_diffraction

- bokeh, dof
  - http://jtra.cz/stuff/essays/bokeh/index.html
  - http://www.siliconstudio.co.jp/en/rd/presentations/
  - https://www.slideshare.net/DICEStudio/five-rendering-ideas-from-battlefield-3-need-for-speed-the-run
  - http://advances.realtimerendering.com/s2011/index.html
  - https://www.shadertoy.com/view/Xd33Ds, https://www.shadertoy.com/view/4d2Xzw
  - https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch28.html
  - https://mynameismjp.wordpress.com/2011/02/28/bokeh/

- "Separable" 2D convolution mathematically
  - https://en.wikipedia.org/wiki/Gaussian_blur
  - when kernel size is `d` and frame buffer's size is `w * h`,
    separable version costs `w * h * d + w * h * d` and normal version costs `w * h * d * d`.

```
Given a probability distribution P and Q s.t.

- P:  R   -> [0, 1]
- Q:  R^2 -> [0, 1]
- where Q(x, y) = P(x)Q(y)

PROP.

For any function F: R^2 -> R,
define G, H, I: R^2 -> R as follows:

G(x, y) = \sum F(x + s, y + t) Q(s, t) ds dt
H(x, y) = \sum F(x + s, y) P(s) ds
I(x, y) = \sum H(x, y + t) P(t) dt

then, G = I.

PROOF. obvious..
```

- GPU Scatter writes
  - https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter32.html
  - https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch28.html
  - https://stackoverflow.com/questions/9440721/efficient-gpu-random-memory-access-with-opengl


# 2017-11-14, 2017-11-15

- blender windows build
  - https://git.blender.org/gitweb/gitweb.cgi/blender.git
  - https://wiki.blender.org/index.php/Dev:Doc/Building_Blender/Windows
  - install cmake via choco and pull source and library in cygwin then `make lite 2017` in cmd.exe

- windows stuff
  - chocolatey
  - install flag (eg `ADD_CMAKE_TO_PATH` from https://chocolatey.org/packages/cmake)
  - VsDevCmd.bat (aka "Developer Command Prompt for VS 2017")

- level design
  - https://www.youtube.com/watch?v=MaUt1p3PQvo

- Game asset creation (blender)
  - https://www.youtube.com/watch?v=wHmw783xreY
  - https://www.youtube.com/watch?v=ATE0TzrIhp4
  - https://www.youtube.com/watch?v=qeQWfc_kyXA
  - https://www.youtube.com/user/blendercookie/videos
  - https://www.youtube.com/user/CGAstym/videos
  - modeling, sculpting, retopology, texture baking


# 2017-11-16

- windows stuff
  - vscode cygwin git workaround
  - https://cygwin.com/cygwin-ug-net/highlights.html#ov-hi-files
  - https://github.com/Microsoft/vscode/issues/7998

- blender vscode scripts
  - learn from what unreal 4.18 does
  - https://github.com/Microsoft/vscode-cpptools/blob/master/launch.md
  - https://code.visualstudio.com/docs/extensionAPI/api-debugging

```json
// .vscode/task.json
{
  "version": "2.0.0",
  "tasks": [
    // NOTE: Assume "make nobuild lite debug 2017 noge" has been run
    {
      "label": "Build Blender",
      "type": "shell",
      "command": "rebuild.cmd",
      "options": {
        "cwd": "C:\\Users\\hiogawa-microsoft\\code\\others\\blender-git\\build_windows_Lite_noge_x64_vc15_Debug"
      }
    }
  ]
}

// .vscode/launch.json
{
    // cf https://github.com/Microsoft/vscode-cpptools/blob/master/launch.md
	"version": "0.2.0",
	"configurations": [
		{
			"name": "Blender",
			"request": "launch",
            "type": "cppvsdbg",
			"stopAtEntry": false,
			"externalConsole": true,
      "program": "C:\\Users\\hiogawa-microsoft\\code\\others\\blender-git\\build_windows_Lite_noge_x64_vc15_Debug\\bin\\Debug\\blender.exe",
			"args": []
    }
  ]
}
```

- blender sculpting/painting architecture
  - brush variants and parameters
  - dynamic topology

```
- SCULPT_OT_brush_stroke registers wmOperatorType (eg sculpt_brush_stroke_invoke, paint_stroke_modal operations)
- sculpt_brush_stroke_invoke => ..
- paint_stroke_modal => ..
```

- flowmap simulation
  - https://www.shadertoy.com/view/MsscD4


# Next time

- retopology algorithm
  - https://github.com/wjakob/instant-meshes
  - https://github.com/cnr-isti-vclab/meshlab

- cloud rendering
  - raymarch
  - noise

- normal map format
  - http://www.nvidia.com/object/real-time-normal-map-dxt-compression.html

- camera 101
  - https://en.wikipedia.org/wiki/Camera
  - basic specification
  - iso

- telescope effect
  - https://en.wikipedia.org/wiki/Reflecting_telescope
  - https://en.wikipedia.org/wiki/Refracting_telescope

- Unity3d shader development
  - https://docs.unity3d.com/Manual/SL-Reference.html
  - https://unity3d.com/learn/tutorials/topics/graphics/session-introduction?playlist=17102
  - https://www.youtube.com/watch?v=_Ys7PlkKdYY
  - https://www.youtube.com/watch?v=oCc0hyERUo8

- shadertoy warp door
  - two scenes
  - camera setup
  - door masking

- Unreal engine
  - curl noise
  - render volumetric fog:

- 1D signal (audio signal, time domain, response function)
  - like, simulating DSP effect on water surface ??
  - low/high pass, distortion, reverb

- diffraction, disparsion
  - https://developer.nvidia.com/gpugems/GPUGems/gpugems_ch08.html
  - https://mybroadband.co.za/news/gadgets/130658-what-cds-dvds-blu-rays-look-like-under-a-microscope.html
  - effect in Wolfensteinhttps://youtu.be/R1qgpvh-fvw?t=3m52s / (c^2 / q^2)
  - https://en.wikipedia.org/wiki/Phase_velocity
  - https://en.wikipedia.org/wiki/Dispersion_(optics)

- parallax fake window
  - https://www.youtube.com/watch?v=zzmt8UdUDek

- Measuring the number of GPU Instructions
  - Unreal engine `FMaterialEditor::DrawMaterialInfoStrings`, `FMaterialResource::GetRepresentativeInstructionCounts`
  - D3D
  - OpenGL

- Unreal engine particle

```
AEmitter < AActor
UParticleSystemComponent < UPrimitiveComponent
UParticleSystem
UParticleModule > UParticleModuleRequired
                > UParticleModuleSpawnBase > UParticleModuleSpawn
                > ..
```

- GPU Gems: https://developer.nvidia.com/gpugems/GPUGems/gpugems_pref01.html

- https://renderpeople.com/free-3d-model/

- unreal engine
  - play with volumentric, translucency stuff
  - import asset from blender via fbx
  - play with particle (collision, vector field)

- post process ideas
  - anti glare pc screen
  - screen looked from angle
  - first person camera blinking
  - CRT TV switch on/off

- compare unreal engine with others
  - unity3d
  - cryengine https://github.com/CRYTEK/CRYENGINE
  - rendering pipeline
  - shader development
  - third party dependency
  - prefab

- unreal engine architecture
  - [x] build system (editor, project, plugin)
  - [x] platform abstraction layer (Runtime/Core/Public/HAL/, RHI)
  - [x] player control
  - [x] shader code management (hlslcc, compilation, runtime loading)
  - [x] c++ reflection
  - [x] visual programming (based on top of reflection)
  - [ ] rendering pipeline (deferred shading, alpha pass (translucency), post process passes, framebuffers, lightmass)
  - [ ] light precomputing
  - [ ] editor architecture `UUnrealEdEngine`, PIE (separate Viewport, separate world), Viewport gizmo (eg landscape tools),
  - [ ] particle system
  - [ ] networking/streaming level system
  - [ ] physx integration
  - [ ] hlslcc in detail `FHlslCrossCompilerContext::Init, Run`
  - https://docs.unrealengine.com/latest/INT/Engine/LevelStreaming/index.html
  - https://docs.unrealengine.com/latest/INT/Gameplay/Networking/index.html

- http://doc.babylonjs.com/tutorials/using_the_volumetric_lightscattering_post-process
  - isn't it similar to contact shadow

- vulkan example
  - https://github.com/ocornut/imgui/pull/1367

- disney pbr brdf
  - https://disney-animation.s3.amazonaws.com/library/s2012_pbs_disney_brdf_notes_v2.pdf

- godot android build
  - on x86 emulator `scons platform=android android_arch=x86`
  - cf. platform/android/detect.py, SCsub

- cool rendering stuff
  - https://www.youtube.com/watch?v=QGIKrD7uHu8
  - https://en.wikipedia.org/wiki/Caustic_(optics)

- [ ] AR, VR
  - http://blogs.valvesoftware.com/abrash/why-virtual-isnt-real-to-your-brain/
  - http://blogs.valvesoftware.com/abrash/slides-from-my-game-developers-conference-talk/
  - lens distortion
  - AR background

- [ ] volumetric things in real time
  - frame, smoke, cloud
  - transmission, refraction

- [ ] soft body simulation
  - https://docs.blender.org/manual/en/dev/physics/soft_body/introduction.html#typical-scenarios-for-using-soft-bodies

- unreal
  - https://www.youtube.com/watch?v=Vhsllsv53K0
  - https://www.youtube.com/watch?v=nVes6OUyzdw

- try building these
  - https://gitlab.com/xonotic/xonotic
  - https://github.com/minetest/minetest

- buy
  - https://www.humblebundle.com/store/life-is-strange-complete-season

- know some unreal's system
  - https://www.youtube.com/watch?v=QGIKrD7uHu8

- game dev experiment
  - camera control
  - asset import from blender (mesh, skelton, animation, texture (diffuse, occlusion..))
  - [ ] bokeh post process

- [ ] lens, light continued
  - https://en.wikipedia.org/wiki/Lens_flare
  - https://en.wikipedia.org/wiki/Crepuscular_rays

- Write CV

- SIGGRAPH couse, papers
  - http://blog.selfshadow.com/publications/s2016-shading-course/karis/s2016_pbs_epic_hair.pdf
  - http://research.tri-ace.com/s2015.html

- Read Unreal rendering feature
  - https://docs.unrealengine.com/latest/INT/Engine/Rendering/index.html

- Read Unity rendering feature
  - https://docs.unity3d.com/Manual/Graphics.html

- Read armory rendering feature
  - http://forums.armory3d.org/t/build-12-is-out/424

- Godot shading techniques
  - copy back buffer (restricted region screen-space effect)

- libretro, emulator
  - https://www.libretro.com/index.php/getting-started-with-retroarch/
  - frontend example: https://github.com/libretro/RetroArch
  - core example: https://github.com/libretro/mupen64plus-libretro
  - content example: https://www.loveroms.com/roms/nintendo-64
  - dig into linux backend implementation
  - emulator architecture
      - http://mupen64plus.org/docs/
      - https://www.loveroms.com/roms/nintendo-64
      - file format

- Computer graphics
  - blender 2.8 viewport (eevee)
  - gpu feedback api
  - linux gpu driver implementation
  - linux gl implementation
  - volumetric

- tackle these
  - https://doomwiki.org/wiki/Doom_source_code
  - https://developer.nvidia.com/what-is-gameworks
  - https://github.com/nothings/stb/

- rust implementation
  - llvm binding in rust ?
  - module system (binary module)
  - type system
  - llvm in freestanding
