<!--
{
  "title": "Qt",
  "date": "2017-05-18T12:28:03+09:00",
  "category": "",
  "tags": ["linux"],
  "draft": true
}
-->


# TODO

- build from source
- cmake-based application build
- platform plugin architecture
- wayland client example
- wayland server example


# Build from source

- learn from arch package (qt5-base)
- https://wiki.qt.io/Building_Qt_5_from_Git


# TODO

- signal and slot
  - QObject::connect
  - emit
- property
  - set property
- QApplication
- QWindow
- QWidget
- gui loop
  - ui event hit testing
  - event dispatch
  - layout
  - draw

---

Example

```
#include <QApplication>
#include <QPushButton>

QPushButton *_button;
void _setText() {
  _button->setText(_button->isDown() ? "" : "Hello world !");
}

int main(int argc, char **argv) {
 QApplication app (argc, argv);

 QPushButton button ("Hello world !");
 _button = &button;
 QObject::connect(&button, &QPushButton::pressed,  _setText);
 QObject::connect(&button, &QPushButton::released, _setText);
 button.show();

 return app.exec();
}
```

Overview

```
[ Data structure ]

- QApplication < QGuiApplication < QCoreApplication < QObject
  - QApplicationPrivate < QGuiApplicationPrivate < QCoreApplicationPrivate < QObjectPrivate < QObjectData (d_ptr)
    - QObject (q_ptr), QObject (parent), QObjectList (children)
    - QAbstractDynamicMetaObject < QDynamicMetaObjectData, < QMetaObject
    - Connection (senders)

- QXcbIntegration < QPlatformIntegration
  - QXcbNativeInterface < QPlatformNativeInterface
  - QList<QXcbConnection *>
    - xcb_connection_t ..

- QPushButton < QAbstractButton < QWidget < QObject, QPaintDevice


[ Procedure ]

- main =>
  - QApplication =>
    - new QApplicationPrivate =>
      - QGuiApplicationPrivate =>
        - QCoreApplicationPrivate =>
          - QObjectPrivate => ..
      - static self = this
    - QGuiApplication =>
      - QCoreApplication =>
        - QObject => d_ptr = #<QApplicationPrivate>
        - d_ptr->q_ptr = this
    - Q_D --> d_func => qGetPtrHelper(d_ptr) => d_ptr (as QApplicationPrivate)
    - QApplicationPrivate::init =>
      - QGuiApplicationPrivate::init =>
        - QCoreApplicationPrivate::init =>
          - Q_Q --> q_func => q_ptr (as QCoreApplication)
          - QCoreApplication::self = q
        - createPlatformIntegration =>
          - static platform_integration = QPlatformIntegrationFactory::create =>
            - directLoader --> QFactoryLoader =>
            - qLoadPlugin<QPlatformIntegration ..>(..) =>
              - QXcbIntegration =>
                - new QXcbConnection => XOpenDisplay ..
      - initialize => ..
  - QPushButton =>
    - QPushButton =>
      - new QPushButtonPrivate => ..
      - QAbstractButton =>
        - QWidget =>
          - QObject, QPaintDevice
          - QWidgetPrivate::init =>
            - static allWidgets.insert
            - QApplication::sendEvent(.. QEvent::Create)
            - QApplication::postEvent(.. new QEvent(QEvent::PolishRequest))
        - QAbstractButtonPrivate::init ..
      - init => resetLayoutItemMargins ..
    - QAbstractButton::setText =>
      - update =>
        - QApplication::postEvent(this, new QUpdateLaterEvent(#<QRect>)
      - updateGeometry => QWidgetPrivate::updateGeometry_helper => ..
  - QWidget::show => setVisible =>
    - create => QWidgetPrivate::create_sys => createTLSysExtra => new QWidgetWindow
    - QLayout::activate =>
      - activateRecursiveHelper ..
      - QLayoutPrivate::doResize => QLayout::setGeometry
    - QWidgetPrivate::show_helper =>
      - QApplication::sendEvent(q, &showEvent)
      - show_sys =>
        - QApplication::postEvent(q, new QUpdateLaterEvent)
        - QWindow::setVisible =>
          - QWindowPrivate::create =>
            - platformWindow = QXcbIntegration::createPlatformWindow =>
              - new QXcbWindow, QXcbWindow::create => xcb_create_window ..
          - QGuiApplication::sendEvent(this, &showEvent)
          - platformWindow->setVisible (QXcbWindow::setVisible ..)
    - QApplication::sendEvent(this, &showToParentEvent)
  - QObject::connect => ??
  - QApplication::exec =>
    - ?? QEventLoop
```
